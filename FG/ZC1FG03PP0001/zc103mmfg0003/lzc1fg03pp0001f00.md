```abap
*---------------------------------------------------------------------*
*    view related FORM routines
*   generation date: 2025.06.04 at 20:11:23
*   view maintenance generator version: #001407#
*---------------------------------------------------------------------*
*...processing: ZC103FIV0002....................................*
FORM GET_DATA_ZC103FIV0002.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM ZC103FIT0002 WHERE
(VIM_WHERETAB) .
    CLEAR ZC103FIV0002 .
ZC103FIV0002-MANDT =
ZC103FIT0002-MANDT .
ZC103FIV0002-BUKRS =
ZC103FIT0002-BUKRS .
ZC103FIV0002-BELNR =
ZC103FIT0002-BELNR .
ZC103FIV0002-GJAHR =
ZC103FIT0002-GJAHR .
ZC103FIV0002-BUZEI =
ZC103FIT0002-BUZEI .
ZC103FIV0002-BLDAT =
ZC103FIT0002-BLDAT .
ZC103FIV0002-BLART =
ZC103FIT0002-BLART .
ZC103FIV0002-BUDAT =
ZC103FIT0002-BUDAT .
ZC103FIV0002-SGTXT =
ZC103FIT0002-SGTXT .
ZC103FIV0002-USCODE =
ZC103FIT0002-USCODE .
ZC103FIV0002-USNAME =
ZC103FIT0002-USNAME .
ZC103FIV0002-TYPE_ID =
ZC103FIT0002-TYPE_ID .
ZC103FIV0002-CAT_ID =
ZC103FIT0002-CAT_ID .
ZC103FIV0002-BSCHL =
ZC103FIT0002-BSCHL .
ZC103FIV0002-KOART =
ZC103FIT0002-KOART .
ZC103FIV0002-SHKZG =
ZC103FIT0002-SHKZG .
ZC103FIV0002-HKONT =
ZC103FIT0002-HKONT .
ZC103FIV0002-WRBTR =
ZC103FIT0002-WRBTR .
ZC103FIV0002-DMBTR =
ZC103FIT0002-DMBTR .
ZC103FIV0002-WAERS =
ZC103FIT0002-WAERS .
ZC103FIV0002-K_WAERS =
ZC103FIT0002-K_WAERS .
ZC103FIV0002-MWSKZ =
ZC103FIT0002-MWSKZ .
ZC103FIV0002-HWBAS =
ZC103FIT0002-HWBAS .
ZC103FIV0002-MWSTS =
ZC103FIT0002-MWSTS .
ZC103FIV0002-ZUONR =
ZC103FIT0002-ZUONR .
ZC103FIV0002-AUGBL =
ZC103FIT0002-AUGBL .
ZC103FIV0002-AUGDT =
ZC103FIT0002-AUGDT .
ZC103FIV0002-OBELNR =
ZC103FIT0002-OBELNR .
ZC103FIV0002-BP_ID =
ZC103FIT0002-BP_ID .
ZC103FIV0002-BP_NAME =
ZC103FIT0002-BP_NAME .
ZC103FIV0002-ANLN1 =
ZC103FIT0002-ANLN1 .
ZC103FIV0002-MATNR =
ZC103FIT0002-MATNR .
ZC103FIV0002-WERKS =
ZC103FIT0002-WERKS .
ZC103FIV0002-MBLNR =
ZC103FIT0002-MBLNR .
ZC103FIV0002-ERDAT =
ZC103FIT0002-ERDAT .
ZC103FIV0002-ERZET =
ZC103FIT0002-ERZET .
ZC103FIV0002-ERNAM =
ZC103FIT0002-ERNAM .
ZC103FIV0002-AEDAT =
ZC103FIT0002-AEDAT .
ZC103FIV0002-AEZET =
ZC103FIT0002-AEZET .
ZC103FIV0002-AENAM =
ZC103FIT0002-AENAM .
<VIM_TOTAL_STRUC> = ZC103FIV0002.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_ZC103FIV0002 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO ZC103FIV0002.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_ZC103FIV0002-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM ZC103FIT0002 WHERE
  BUKRS = ZC103FIV0002-BUKRS AND
  BELNR = ZC103FIV0002-BELNR AND
  GJAHR = ZC103FIV0002-GJAHR AND
  BUZEI = ZC103FIV0002-BUZEI .
    IF SY-SUBRC = 0.
    DELETE ZC103FIT0002 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM ZC103FIT0002 WHERE
  BUKRS = ZC103FIV0002-BUKRS AND
  BELNR = ZC103FIV0002-BELNR AND
  GJAHR = ZC103FIV0002-GJAHR AND
  BUZEI = ZC103FIV0002-BUZEI .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR ZC103FIT0002.
    ENDIF.
ZC103FIT0002-MANDT =
ZC103FIV0002-MANDT .
ZC103FIT0002-BUKRS =
ZC103FIV0002-BUKRS .
ZC103FIT0002-BELNR =
ZC103FIV0002-BELNR .
ZC103FIT0002-GJAHR =
ZC103FIV0002-GJAHR .
ZC103FIT0002-BUZEI =
ZC103FIV0002-BUZEI .
ZC103FIT0002-BLDAT =
ZC103FIV0002-BLDAT .
ZC103FIT0002-BLART =
ZC103FIV0002-BLART .
ZC103FIT0002-BUDAT =
ZC103FIV0002-BUDAT .
ZC103FIT0002-SGTXT =
ZC103FIV0002-SGTXT .
ZC103FIT0002-USCODE =
ZC103FIV0002-USCODE .
ZC103FIT0002-USNAME =
ZC103FIV0002-USNAME .
ZC103FIT0002-TYPE_ID =
ZC103FIV0002-TYPE_ID .
ZC103FIT0002-CAT_ID =
ZC103FIV0002-CAT_ID .
ZC103FIT0002-BSCHL =
ZC103FIV0002-BSCHL .
ZC103FIT0002-KOART =
ZC103FIV0002-KOART .
ZC103FIT0002-SHKZG =
ZC103FIV0002-SHKZG .
ZC103FIT0002-HKONT =
ZC103FIV0002-HKONT .
ZC103FIT0002-WRBTR =
ZC103FIV0002-WRBTR .
ZC103FIT0002-DMBTR =
ZC103FIV0002-DMBTR .
ZC103FIT0002-WAERS =
ZC103FIV0002-WAERS .
ZC103FIT0002-K_WAERS =
ZC103FIV0002-K_WAERS .
ZC103FIT0002-MWSKZ =
ZC103FIV0002-MWSKZ .
ZC103FIT0002-HWBAS =
ZC103FIV0002-HWBAS .
ZC103FIT0002-MWSTS =
ZC103FIV0002-MWSTS .
ZC103FIT0002-ZUONR =
ZC103FIV0002-ZUONR .
ZC103FIT0002-AUGBL =
ZC103FIV0002-AUGBL .
ZC103FIT0002-AUGDT =
ZC103FIV0002-AUGDT .
ZC103FIT0002-OBELNR =
ZC103FIV0002-OBELNR .
ZC103FIT0002-BP_ID =
ZC103FIV0002-BP_ID .
ZC103FIT0002-BP_NAME =
ZC103FIV0002-BP_NAME .
ZC103FIT0002-ANLN1 =
ZC103FIV0002-ANLN1 .
ZC103FIT0002-MATNR =
ZC103FIV0002-MATNR .
ZC103FIT0002-WERKS =
ZC103FIV0002-WERKS .
ZC103FIT0002-MBLNR =
ZC103FIV0002-MBLNR .
ZC103FIT0002-ERDAT =
ZC103FIV0002-ERDAT .
ZC103FIT0002-ERZET =
ZC103FIV0002-ERZET .
ZC103FIT0002-ERNAM =
ZC103FIV0002-ERNAM .
ZC103FIT0002-AEDAT =
ZC103FIV0002-AEDAT .
ZC103FIT0002-AEZET =
ZC103FIV0002-AEZET .
ZC103FIT0002-AENAM =
ZC103FIV0002-AENAM .
    IF SY-SUBRC = 0.
    UPDATE ZC103FIT0002 ##WARN_OK.
    ELSE.
    INSERT ZC103FIT0002 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_ZC103FIV0002-UPD_FLAG,
STATUS_ZC103FIV0002-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_ZC103FIV0002.
  SELECT SINGLE * FROM ZC103FIT0002 WHERE
BUKRS = ZC103FIV0002-BUKRS AND
BELNR = ZC103FIV0002-BELNR AND
GJAHR = ZC103FIV0002-GJAHR AND
BUZEI = ZC103FIV0002-BUZEI .
ZC103FIV0002-MANDT =
ZC103FIT0002-MANDT .
ZC103FIV0002-BUKRS =
ZC103FIT0002-BUKRS .
ZC103FIV0002-BELNR =
ZC103FIT0002-BELNR .
ZC103FIV0002-GJAHR =
ZC103FIT0002-GJAHR .
ZC103FIV0002-BUZEI =
ZC103FIT0002-BUZEI .
ZC103FIV0002-BLDAT =
ZC103FIT0002-BLDAT .
ZC103FIV0002-BLART =
ZC103FIT0002-BLART .
ZC103FIV0002-BUDAT =
ZC103FIT0002-BUDAT .
ZC103FIV0002-SGTXT =
ZC103FIT0002-SGTXT .
ZC103FIV0002-USCODE =
ZC103FIT0002-USCODE .
ZC103FIV0002-USNAME =
ZC103FIT0002-USNAME .
ZC103FIV0002-TYPE_ID =
ZC103FIT0002-TYPE_ID .
ZC103FIV0002-CAT_ID =
ZC103FIT0002-CAT_ID .
ZC103FIV0002-BSCHL =
ZC103FIT0002-BSCHL .
ZC103FIV0002-KOART =
ZC103FIT0002-KOART .
ZC103FIV0002-SHKZG =
ZC103FIT0002-SHKZG .
ZC103FIV0002-HKONT =
ZC103FIT0002-HKONT .
ZC103FIV0002-WRBTR =
ZC103FIT0002-WRBTR .
ZC103FIV0002-DMBTR =
ZC103FIT0002-DMBTR .
ZC103FIV0002-WAERS =
ZC103FIT0002-WAERS .
ZC103FIV0002-K_WAERS =
ZC103FIT0002-K_WAERS .
ZC103FIV0002-MWSKZ =
ZC103FIT0002-MWSKZ .
ZC103FIV0002-HWBAS =
ZC103FIT0002-HWBAS .
ZC103FIV0002-MWSTS =
ZC103FIT0002-MWSTS .
ZC103FIV0002-ZUONR =
ZC103FIT0002-ZUONR .
ZC103FIV0002-AUGBL =
ZC103FIT0002-AUGBL .
ZC103FIV0002-AUGDT =
ZC103FIT0002-AUGDT .
ZC103FIV0002-OBELNR =
ZC103FIT0002-OBELNR .
ZC103FIV0002-BP_ID =
ZC103FIT0002-BP_ID .
ZC103FIV0002-BP_NAME =
ZC103FIT0002-BP_NAME .
ZC103FIV0002-ANLN1 =
ZC103FIT0002-ANLN1 .
ZC103FIV0002-MATNR =
ZC103FIT0002-MATNR .
ZC103FIV0002-WERKS =
ZC103FIT0002-WERKS .
ZC103FIV0002-MBLNR =
ZC103FIT0002-MBLNR .
ZC103FIV0002-ERDAT =
ZC103FIT0002-ERDAT .
ZC103FIV0002-ERZET =
ZC103FIT0002-ERZET .
ZC103FIV0002-ERNAM =
ZC103FIT0002-ERNAM .
ZC103FIV0002-AEDAT =
ZC103FIT0002-AEDAT .
ZC103FIV0002-AEZET =
ZC103FIT0002-AEZET .
ZC103FIV0002-AENAM =
ZC103FIT0002-AENAM .
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_ZC103FIV0002 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE ZC103FIV0002-BUKRS TO
ZC103FIT0002-BUKRS .
MOVE ZC103FIV0002-BELNR TO
ZC103FIT0002-BELNR .
MOVE ZC103FIV0002-GJAHR TO
ZC103FIT0002-GJAHR .
MOVE ZC103FIV0002-BUZEI TO
ZC103FIT0002-BUZEI .
MOVE ZC103FIV0002-MANDT TO
ZC103FIT0002-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = 'ZC103FIT0002'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN ZC103FIT0002 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING 'ZC103FIT0002'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
*...processing: ZC103FIV0014....................................*
FORM GET_DATA_ZC103FIV0014.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM ZC103FIT0014 WHERE
(VIM_WHERETAB) .
    CLEAR ZC103FIV0014 .
ZC103FIV0014-MANDT =
ZC103FIT0014-MANDT .
ZC103FIV0014-BUKRS =
ZC103FIT0014-BUKRS .
ZC103FIV0014-ANLN1 =
ZC103FIT0014-ANLN1 .
ZC103FIV0014-GJAHR =
ZC103FIT0014-GJAHR .
ZC103FIV0014-ANLNT =
ZC103FIT0014-ANLNT .
ZC103FIV0014-ANLKL =
ZC103FIT0014-ANLKL .
ZC103FIV0014-KOSTL =
ZC103FIT0014-KOSTL .
ZC103FIV0014-AFASL =
ZC103FIT0014-AFASL .
ZC103FIV0014-ALIFE =
ZC103FIT0014-ALIFE .
ZC103FIV0014-APRICE =
ZC103FIT0014-APRICE .
ZC103FIV0014-ACCUM =
ZC103FIT0014-ACCUM .
ZC103FIV0014-CURRENCY =
ZC103FIT0014-CURRENCY .
ZC103FIV0014-ABUDAT =
ZC103FIT0014-ABUDAT .
ZC103FIV0014-ERDAT =
ZC103FIT0014-ERDAT .
ZC103FIV0014-ERZET =
ZC103FIT0014-ERZET .
ZC103FIV0014-ERNAM =
ZC103FIT0014-ERNAM .
ZC103FIV0014-AEDAT =
ZC103FIT0014-AEDAT .
ZC103FIV0014-AEZET =
ZC103FIT0014-AEZET .
ZC103FIV0014-AENAM =
ZC103FIT0014-AENAM .
<VIM_TOTAL_STRUC> = ZC103FIV0014.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_ZC103FIV0014 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO ZC103FIV0014.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_ZC103FIV0014-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM ZC103FIT0014 WHERE
  BUKRS = ZC103FIV0014-BUKRS AND
  ANLN1 = ZC103FIV0014-ANLN1 AND
  GJAHR = ZC103FIV0014-GJAHR .
    IF SY-SUBRC = 0.
    DELETE ZC103FIT0014 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM ZC103FIT0014 WHERE
  BUKRS = ZC103FIV0014-BUKRS AND
  ANLN1 = ZC103FIV0014-ANLN1 AND
  GJAHR = ZC103FIV0014-GJAHR .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR ZC103FIT0014.
    ENDIF.
ZC103FIT0014-MANDT =
ZC103FIV0014-MANDT .
ZC103FIT0014-BUKRS =
ZC103FIV0014-BUKRS .
ZC103FIT0014-ANLN1 =
ZC103FIV0014-ANLN1 .
ZC103FIT0014-GJAHR =
ZC103FIV0014-GJAHR .
ZC103FIT0014-ANLNT =
ZC103FIV0014-ANLNT .
ZC103FIT0014-ANLKL =
ZC103FIV0014-ANLKL .
ZC103FIT0014-KOSTL =
ZC103FIV0014-KOSTL .
ZC103FIT0014-AFASL =
ZC103FIV0014-AFASL .
ZC103FIT0014-ALIFE =
ZC103FIV0014-ALIFE .
ZC103FIT0014-APRICE =
ZC103FIV0014-APRICE .
ZC103FIT0014-ACCUM =
ZC103FIV0014-ACCUM .
ZC103FIT0014-CURRENCY =
ZC103FIV0014-CURRENCY .
ZC103FIT0014-ABUDAT =
ZC103FIV0014-ABUDAT .
ZC103FIT0014-ERDAT =
ZC103FIV0014-ERDAT .
ZC103FIT0014-ERZET =
ZC103FIV0014-ERZET .
ZC103FIT0014-ERNAM =
ZC103FIV0014-ERNAM .
ZC103FIT0014-AEDAT =
ZC103FIV0014-AEDAT .
ZC103FIT0014-AEZET =
ZC103FIV0014-AEZET .
ZC103FIT0014-AENAM =
ZC103FIV0014-AENAM .
    IF SY-SUBRC = 0.
    UPDATE ZC103FIT0014 ##WARN_OK.
    ELSE.
    INSERT ZC103FIT0014 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_ZC103FIV0014-UPD_FLAG,
STATUS_ZC103FIV0014-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_ZC103FIV0014.
  SELECT SINGLE * FROM ZC103FIT0014 WHERE
BUKRS = ZC103FIV0014-BUKRS AND
ANLN1 = ZC103FIV0014-ANLN1 AND
GJAHR = ZC103FIV0014-GJAHR .
ZC103FIV0014-MANDT =
ZC103FIT0014-MANDT .
ZC103FIV0014-BUKRS =
ZC103FIT0014-BUKRS .
ZC103FIV0014-ANLN1 =
ZC103FIT0014-ANLN1 .
ZC103FIV0014-GJAHR =
ZC103FIT0014-GJAHR .
ZC103FIV0014-ANLNT =
ZC103FIT0014-ANLNT .
ZC103FIV0014-ANLKL =
ZC103FIT0014-ANLKL .
ZC103FIV0014-KOSTL =
ZC103FIT0014-KOSTL .
ZC103FIV0014-AFASL =
ZC103FIT0014-AFASL .
ZC103FIV0014-ALIFE =
ZC103FIT0014-ALIFE .
ZC103FIV0014-APRICE =
ZC103FIT0014-APRICE .
ZC103FIV0014-ACCUM =
ZC103FIT0014-ACCUM .
ZC103FIV0014-CURRENCY =
ZC103FIT0014-CURRENCY .
ZC103FIV0014-ABUDAT =
ZC103FIT0014-ABUDAT .
ZC103FIV0014-ERDAT =
ZC103FIT0014-ERDAT .
ZC103FIV0014-ERZET =
ZC103FIT0014-ERZET .
ZC103FIV0014-ERNAM =
ZC103FIT0014-ERNAM .
ZC103FIV0014-AEDAT =
ZC103FIT0014-AEDAT .
ZC103FIV0014-AEZET =
ZC103FIT0014-AEZET .
ZC103FIV0014-AENAM =
ZC103FIT0014-AENAM .
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_ZC103FIV0014 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE ZC103FIV0014-BUKRS TO
ZC103FIT0014-BUKRS .
MOVE ZC103FIV0014-ANLN1 TO
ZC103FIT0014-ANLN1 .
MOVE ZC103FIV0014-GJAHR TO
ZC103FIT0014-GJAHR .
MOVE ZC103FIV0014-MANDT TO
ZC103FIT0014-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = 'ZC103FIT0014'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN ZC103FIT0014 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING 'ZC103FIT0014'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
*...processing: ZC103FIV0015....................................*
FORM GET_DATA_ZC103FIV0015.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM ZC103FIT0015 WHERE
(VIM_WHERETAB) .
    CLEAR ZC103FIV0015 .
ZC103FIV0015-MANDT =
ZC103FIT0015-MANDT .
ZC103FIV0015-SRNUM =
ZC103FIT0015-SRNUM .
ZC103FIV0015-BELNR =
ZC103FIT0015-BELNR .
ZC103FIV0015-GJAHR =
ZC103FIT0015-GJAHR .
ZC103FIV0015-ANLNT =
ZC103FIT0015-ANLNT .
ZC103FIV0015-ANLKL =
ZC103FIT0015-ANLKL .
ZC103FIV0015-KTOGR =
ZC103FIT0015-KTOGR .
ZC103FIV0015-URWRT =
ZC103FIT0015-URWRT .
ZC103FIV0015-CURRENCY =
ZC103FIT0015-CURRENCY .
ZC103FIV0015-URJHR =
ZC103FIT0015-URJHR .
ZC103FIV0015-RDVALUE =
ZC103FIT0015-RDVALUE .
ZC103FIV0015-DPVALUE =
ZC103FIT0015-DPVALUE .
ZC103FIV0015-DYEAR =
ZC103FIT0015-DYEAR .
ZC103FIV0015-VBELN =
ZC103FIT0015-VBELN .
ZC103FIV0015-CUSTNO =
ZC103FIT0015-CUSTNO .
ZC103FIV0015-ERDAT =
ZC103FIT0015-ERDAT .
ZC103FIV0015-ERZET =
ZC103FIT0015-ERZET .
ZC103FIV0015-ERNAM =
ZC103FIT0015-ERNAM .
ZC103FIV0015-AEDAT =
ZC103FIT0015-AEDAT .
ZC103FIV0015-AEZET =
ZC103FIT0015-AEZET .
ZC103FIV0015-AENAM =
ZC103FIT0015-AENAM .
<VIM_TOTAL_STRUC> = ZC103FIV0015.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_ZC103FIV0015 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO ZC103FIV0015.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_ZC103FIV0015-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM ZC103FIT0015 WHERE
  SRNUM = ZC103FIV0015-SRNUM .
    IF SY-SUBRC = 0.
    DELETE ZC103FIT0015 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM ZC103FIT0015 WHERE
  SRNUM = ZC103FIV0015-SRNUM .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR ZC103FIT0015.
    ENDIF.
ZC103FIT0015-MANDT =
ZC103FIV0015-MANDT .
ZC103FIT0015-SRNUM =
ZC103FIV0015-SRNUM .
ZC103FIT0015-BELNR =
ZC103FIV0015-BELNR .
ZC103FIT0015-GJAHR =
ZC103FIV0015-GJAHR .
ZC103FIT0015-ANLNT =
ZC103FIV0015-ANLNT .
ZC103FIT0015-ANLKL =
ZC103FIV0015-ANLKL .
ZC103FIT0015-KTOGR =
ZC103FIV0015-KTOGR .
ZC103FIT0015-URWRT =
ZC103FIV0015-URWRT .
ZC103FIT0015-CURRENCY =
ZC103FIV0015-CURRENCY .
ZC103FIT0015-URJHR =
ZC103FIV0015-URJHR .
ZC103FIT0015-RDVALUE =
ZC103FIV0015-RDVALUE .
ZC103FIT0015-DPVALUE =
ZC103FIV0015-DPVALUE .
ZC103FIT0015-DYEAR =
ZC103FIV0015-DYEAR .
ZC103FIT0015-VBELN =
ZC103FIV0015-VBELN .
ZC103FIT0015-CUSTNO =
ZC103FIV0015-CUSTNO .
ZC103FIT0015-ERDAT =
ZC103FIV0015-ERDAT .
ZC103FIT0015-ERZET =
ZC103FIV0015-ERZET .
ZC103FIT0015-ERNAM =
ZC103FIV0015-ERNAM .
ZC103FIT0015-AEDAT =
ZC103FIV0015-AEDAT .
ZC103FIT0015-AEZET =
ZC103FIV0015-AEZET .
ZC103FIT0015-AENAM =
ZC103FIV0015-AENAM .
    IF SY-SUBRC = 0.
    UPDATE ZC103FIT0015 ##WARN_OK.
    ELSE.
    INSERT ZC103FIT0015 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_ZC103FIV0015-UPD_FLAG,
STATUS_ZC103FIV0015-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_ZC103FIV0015.
  SELECT SINGLE * FROM ZC103FIT0015 WHERE
SRNUM = ZC103FIV0015-SRNUM .
ZC103FIV0015-MANDT =
ZC103FIT0015-MANDT .
ZC103FIV0015-SRNUM =
ZC103FIT0015-SRNUM .
ZC103FIV0015-BELNR =
ZC103FIT0015-BELNR .
ZC103FIV0015-GJAHR =
ZC103FIT0015-GJAHR .
ZC103FIV0015-ANLNT =
ZC103FIT0015-ANLNT .
ZC103FIV0015-ANLKL =
ZC103FIT0015-ANLKL .
ZC103FIV0015-KTOGR =
ZC103FIT0015-KTOGR .
ZC103FIV0015-URWRT =
ZC103FIT0015-URWRT .
ZC103FIV0015-CURRENCY =
ZC103FIT0015-CURRENCY .
ZC103FIV0015-URJHR =
ZC103FIT0015-URJHR .
ZC103FIV0015-RDVALUE =
ZC103FIT0015-RDVALUE .
ZC103FIV0015-DPVALUE =
ZC103FIT0015-DPVALUE .
ZC103FIV0015-DYEAR =
ZC103FIT0015-DYEAR .
ZC103FIV0015-VBELN =
ZC103FIT0015-VBELN .
ZC103FIV0015-CUSTNO =
ZC103FIT0015-CUSTNO .
ZC103FIV0015-ERDAT =
ZC103FIT0015-ERDAT .
ZC103FIV0015-ERZET =
ZC103FIT0015-ERZET .
ZC103FIV0015-ERNAM =
ZC103FIT0015-ERNAM .
ZC103FIV0015-AEDAT =
ZC103FIT0015-AEDAT .
ZC103FIV0015-AEZET =
ZC103FIT0015-AEZET .
ZC103FIV0015-AENAM =
ZC103FIT0015-AENAM .
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_ZC103FIV0015 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE ZC103FIV0015-SRNUM TO
ZC103FIT0015-SRNUM .
MOVE ZC103FIV0015-MANDT TO
ZC103FIT0015-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = 'ZC103FIT0015'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN ZC103FIT0015 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING 'ZC103FIT0015'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
*...processing: ZC103FIV0022....................................*
FORM GET_DATA_ZC103FIV0022.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM ZC103FIT0022 WHERE
(VIM_WHERETAB) .
    CLEAR ZC103FIV0022 .
ZC103FIV0022-MANDT =
ZC103FIT0022-MANDT .
ZC103FIV0022-BUKRS =
ZC103FIT0022-BUKRS .
ZC103FIV0022-NODE_ID =
ZC103FIT0022-NODE_ID .
ZC103FIV0022-HIER_ID =
ZC103FIT0022-HIER_ID .
ZC103FIV0022-PARENT_NODE_ID =
ZC103FIT0022-PARENT_NODE_ID .
ZC103FIV0022-NODE_TYPE =
ZC103FIT0022-NODE_TYPE .
ZC103FIV0022-NODE_NAME =
ZC103FIT0022-NODE_NAME .
ZC103FIV0022-GL_ACCOUNT =
ZC103FIT0022-GL_ACCOUNT .
ZC103FIV0022-FOLDER_LEVEL =
ZC103FIT0022-FOLDER_LEVEL .
ZC103FIV0022-ERDAT =
ZC103FIT0022-ERDAT .
ZC103FIV0022-ERZET =
ZC103FIT0022-ERZET .
ZC103FIV0022-ERNAM =
ZC103FIT0022-ERNAM .
ZC103FIV0022-AEDAT =
ZC103FIT0022-AEDAT .
ZC103FIV0022-AEZET =
ZC103FIT0022-AEZET .
ZC103FIV0022-AENAM =
ZC103FIT0022-AENAM .
<VIM_TOTAL_STRUC> = ZC103FIV0022.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_ZC103FIV0022 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO ZC103FIV0022.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_ZC103FIV0022-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM ZC103FIT0022 WHERE
  BUKRS = ZC103FIV0022-BUKRS AND
  NODE_ID = ZC103FIV0022-NODE_ID .
    IF SY-SUBRC = 0.
    DELETE ZC103FIT0022 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM ZC103FIT0022 WHERE
  BUKRS = ZC103FIV0022-BUKRS AND
  NODE_ID = ZC103FIV0022-NODE_ID .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR ZC103FIT0022.
    ENDIF.
ZC103FIT0022-MANDT =
ZC103FIV0022-MANDT .
ZC103FIT0022-BUKRS =
ZC103FIV0022-BUKRS .
ZC103FIT0022-NODE_ID =
ZC103FIV0022-NODE_ID .
ZC103FIT0022-HIER_ID =
ZC103FIV0022-HIER_ID .
ZC103FIT0022-PARENT_NODE_ID =
ZC103FIV0022-PARENT_NODE_ID .
ZC103FIT0022-NODE_TYPE =
ZC103FIV0022-NODE_TYPE .
ZC103FIT0022-NODE_NAME =
ZC103FIV0022-NODE_NAME .
ZC103FIT0022-GL_ACCOUNT =
ZC103FIV0022-GL_ACCOUNT .
ZC103FIT0022-FOLDER_LEVEL =
ZC103FIV0022-FOLDER_LEVEL .
ZC103FIT0022-ERDAT =
ZC103FIV0022-ERDAT .
ZC103FIT0022-ERZET =
ZC103FIV0022-ERZET .
ZC103FIT0022-ERNAM =
ZC103FIV0022-ERNAM .
ZC103FIT0022-AEDAT =
ZC103FIV0022-AEDAT .
ZC103FIT0022-AEZET =
ZC103FIV0022-AEZET .
ZC103FIT0022-AENAM =
ZC103FIV0022-AENAM .
    IF SY-SUBRC = 0.
    UPDATE ZC103FIT0022 ##WARN_OK.
    ELSE.
    INSERT ZC103FIT0022 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_ZC103FIV0022-UPD_FLAG,
STATUS_ZC103FIV0022-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_ZC103FIV0022.
  SELECT SINGLE * FROM ZC103FIT0022 WHERE
BUKRS = ZC103FIV0022-BUKRS AND
NODE_ID = ZC103FIV0022-NODE_ID .
ZC103FIV0022-MANDT =
ZC103FIT0022-MANDT .
ZC103FIV0022-BUKRS =
ZC103FIT0022-BUKRS .
ZC103FIV0022-NODE_ID =
ZC103FIT0022-NODE_ID .
ZC103FIV0022-HIER_ID =
ZC103FIT0022-HIER_ID .
ZC103FIV0022-PARENT_NODE_ID =
ZC103FIT0022-PARENT_NODE_ID .
ZC103FIV0022-NODE_TYPE =
ZC103FIT0022-NODE_TYPE .
ZC103FIV0022-NODE_NAME =
ZC103FIT0022-NODE_NAME .
ZC103FIV0022-GL_ACCOUNT =
ZC103FIT0022-GL_ACCOUNT .
ZC103FIV0022-FOLDER_LEVEL =
ZC103FIT0022-FOLDER_LEVEL .
ZC103FIV0022-ERDAT =
ZC103FIT0022-ERDAT .
ZC103FIV0022-ERZET =
ZC103FIT0022-ERZET .
ZC103FIV0022-ERNAM =
ZC103FIT0022-ERNAM .
ZC103FIV0022-AEDAT =
ZC103FIT0022-AEDAT .
ZC103FIV0022-AEZET =
ZC103FIT0022-AEZET .
ZC103FIV0022-AENAM =
ZC103FIT0022-AENAM .
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_ZC103FIV0022 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE ZC103FIV0022-BUKRS TO
ZC103FIT0022-BUKRS .
MOVE ZC103FIV0022-NODE_ID TO
ZC103FIT0022-NODE_ID .
MOVE ZC103FIV0022-MANDT TO
ZC103FIT0022-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = 'ZC103FIT0022'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN ZC103FIT0022 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING 'ZC103FIT0022'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
*...processing: ZC103MMV0001....................................*
FORM GET_DATA_ZC103MMV0001.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM ZC103MMT0001 WHERE
(VIM_WHERETAB) .
    CLEAR ZC103MMV0001 .
ZC103MMV0001-MANDT =
ZC103MMT0001-MANDT .
ZC103MMV0001-MATID =
ZC103MMT0001-MATID .
ZC103MMV0001-MATNAME =
ZC103MMT0001-MATNAME .
ZC103MMV0001-MATTYPE =
ZC103MMT0001-MATTYPE .
ZC103MMV0001-MATGRP =
ZC103MMT0001-MATGRP .
ZC103MMV0001-BASE_UNIT =
ZC103MMT0001-BASE_UNIT .
ZC103MMV0001-DISMM =
ZC103MMT0001-DISMM .
ZC103MMV0001-LOTTYPE =
ZC103MMT0001-LOTTYPE .
ZC103MMV0001-LOTSIZE =
ZC103MMT0001-LOTSIZE .
ZC103MMV0001-RPOINT =
ZC103MMT0001-RPOINT .
ZC103MMV0001-SAFETY_STOCK =
ZC103MMT0001-SAFETY_STOCK .
ZC103MMV0001-PLNID =
ZC103MMT0001-PLNID .
ZC103MMV0001-STRID =
ZC103MMT0001-STRID .
ZC103MMV0001-WEIGHT =
ZC103MMT0001-WEIGHT .
ZC103MMV0001-WEIGHT_UNIT =
ZC103MMT0001-WEIGHT_UNIT .
ZC103MMV0001-IS_SERIAL =
ZC103MMT0001-IS_SERIAL .
ZC103MMV0001-PRICE =
ZC103MMT0001-PRICE .
ZC103MMV0001-CURRENCY =
ZC103MMT0001-CURRENCY .
ZC103MMV0001-ERDAT =
ZC103MMT0001-ERDAT .
ZC103MMV0001-ERZET =
ZC103MMT0001-ERZET .
ZC103MMV0001-ERNAM =
ZC103MMT0001-ERNAM .
ZC103MMV0001-AEDAT =
ZC103MMT0001-AEDAT .
ZC103MMV0001-AEZET =
ZC103MMT0001-AEZET .
ZC103MMV0001-AENAM =
ZC103MMT0001-AENAM .
<VIM_TOTAL_STRUC> = ZC103MMV0001.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_ZC103MMV0001 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO ZC103MMV0001.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_ZC103MMV0001-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM ZC103MMT0001 WHERE
  MATID = ZC103MMV0001-MATID .
    IF SY-SUBRC = 0.
    DELETE ZC103MMT0001 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM ZC103MMT0001 WHERE
  MATID = ZC103MMV0001-MATID .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR ZC103MMT0001.
    ENDIF.
ZC103MMT0001-MANDT =
ZC103MMV0001-MANDT .
ZC103MMT0001-MATID =
ZC103MMV0001-MATID .
ZC103MMT0001-MATNAME =
ZC103MMV0001-MATNAME .
ZC103MMT0001-MATTYPE =
ZC103MMV0001-MATTYPE .
ZC103MMT0001-MATGRP =
ZC103MMV0001-MATGRP .
ZC103MMT0001-BASE_UNIT =
ZC103MMV0001-BASE_UNIT .
ZC103MMT0001-DISMM =
ZC103MMV0001-DISMM .
ZC103MMT0001-LOTTYPE =
ZC103MMV0001-LOTTYPE .
ZC103MMT0001-LOTSIZE =
ZC103MMV0001-LOTSIZE .
ZC103MMT0001-RPOINT =
ZC103MMV0001-RPOINT .
ZC103MMT0001-SAFETY_STOCK =
ZC103MMV0001-SAFETY_STOCK .
ZC103MMT0001-PLNID =
ZC103MMV0001-PLNID .
ZC103MMT0001-STRID =
ZC103MMV0001-STRID .
ZC103MMT0001-WEIGHT =
ZC103MMV0001-WEIGHT .
ZC103MMT0001-WEIGHT_UNIT =
ZC103MMV0001-WEIGHT_UNIT .
ZC103MMT0001-IS_SERIAL =
ZC103MMV0001-IS_SERIAL .
ZC103MMT0001-PRICE =
ZC103MMV0001-PRICE .
ZC103MMT0001-CURRENCY =
ZC103MMV0001-CURRENCY .
ZC103MMT0001-ERDAT =
ZC103MMV0001-ERDAT .
ZC103MMT0001-ERZET =
ZC103MMV0001-ERZET .
ZC103MMT0001-ERNAM =
ZC103MMV0001-ERNAM .
ZC103MMT0001-AEDAT =
ZC103MMV0001-AEDAT .
ZC103MMT0001-AEZET =
ZC103MMV0001-AEZET .
ZC103MMT0001-AENAM =
ZC103MMV0001-AENAM .
    IF SY-SUBRC = 0.
    UPDATE ZC103MMT0001 ##WARN_OK.
    ELSE.
    INSERT ZC103MMT0001 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_ZC103MMV0001-UPD_FLAG,
STATUS_ZC103MMV0001-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_ZC103MMV0001.
  SELECT SINGLE * FROM ZC103MMT0001 WHERE
MATID = ZC103MMV0001-MATID .
ZC103MMV0001-MANDT =
ZC103MMT0001-MANDT .
ZC103MMV0001-MATID =
ZC103MMT0001-MATID .
ZC103MMV0001-MATNAME =
ZC103MMT0001-MATNAME .
ZC103MMV0001-MATTYPE =
ZC103MMT0001-MATTYPE .
ZC103MMV0001-MATGRP =
ZC103MMT0001-MATGRP .
ZC103MMV0001-BASE_UNIT =
ZC103MMT0001-BASE_UNIT .
ZC103MMV0001-DISMM =
ZC103MMT0001-DISMM .
ZC103MMV0001-LOTTYPE =
ZC103MMT0001-LOTTYPE .
ZC103MMV0001-LOTSIZE =
ZC103MMT0001-LOTSIZE .
ZC103MMV0001-RPOINT =
ZC103MMT0001-RPOINT .
ZC103MMV0001-SAFETY_STOCK =
ZC103MMT0001-SAFETY_STOCK .
ZC103MMV0001-PLNID =
ZC103MMT0001-PLNID .
ZC103MMV0001-STRID =
ZC103MMT0001-STRID .
ZC103MMV0001-WEIGHT =
ZC103MMT0001-WEIGHT .
ZC103MMV0001-WEIGHT_UNIT =
ZC103MMT0001-WEIGHT_UNIT .
ZC103MMV0001-IS_SERIAL =
ZC103MMT0001-IS_SERIAL .
ZC103MMV0001-PRICE =
ZC103MMT0001-PRICE .
ZC103MMV0001-CURRENCY =
ZC103MMT0001-CURRENCY .
ZC103MMV0001-ERDAT =
ZC103MMT0001-ERDAT .
ZC103MMV0001-ERZET =
ZC103MMT0001-ERZET .
ZC103MMV0001-ERNAM =
ZC103MMT0001-ERNAM .
ZC103MMV0001-AEDAT =
ZC103MMT0001-AEDAT .
ZC103MMV0001-AEZET =
ZC103MMT0001-AEZET .
ZC103MMV0001-AENAM =
ZC103MMT0001-AENAM .
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_ZC103MMV0001 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE ZC103MMV0001-MATID TO
ZC103MMT0001-MATID .
MOVE ZC103MMV0001-MANDT TO
ZC103MMT0001-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = 'ZC103MMT0001'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN ZC103MMT0001 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING 'ZC103MMT0001'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
*...processing: ZC103MMV0002....................................*
FORM GET_DATA_ZC103MMV0002.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM ZC103MMT0002 WHERE
(VIM_WHERETAB) .
    CLEAR ZC103MMV0002 .
ZC103MMV0002-MANDT =
ZC103MMT0002-MANDT .
ZC103MMV0002-BPID =
ZC103MMT0002-BPID .
ZC103MMV0002-NAME =
ZC103MMT0002-NAME .
ZC103MMV0002-TELLNUM =
ZC103MMT0002-TELLNUM .
ZC103MMV0002-ADDRESS =
ZC103MMT0002-ADDRESS .
ZC103MMV0002-ACCOUNT =
ZC103MMT0002-ACCOUNT .
ZC103MMV0002-CURRENCY =
ZC103MMT0002-CURRENCY .
ZC103MMV0002-PTERM =
ZC103MMT0002-PTERM .
ZC103MMV0002-ERDAT =
ZC103MMT0002-ERDAT .
ZC103MMV0002-ERZET =
ZC103MMT0002-ERZET .
ZC103MMV0002-ERNAM =
ZC103MMT0002-ERNAM .
ZC103MMV0002-AEDAT =
ZC103MMT0002-AEDAT .
ZC103MMV0002-AEZET =
ZC103MMT0002-AEZET .
ZC103MMV0002-AENAM =
ZC103MMT0002-AENAM .
<VIM_TOTAL_STRUC> = ZC103MMV0002.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_ZC103MMV0002 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO ZC103MMV0002.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_ZC103MMV0002-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM ZC103MMT0002 WHERE
  BPID = ZC103MMV0002-BPID .
    IF SY-SUBRC = 0.
    DELETE ZC103MMT0002 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM ZC103MMT0002 WHERE
  BPID = ZC103MMV0002-BPID .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR ZC103MMT0002.
    ENDIF.
ZC103MMT0002-MANDT =
ZC103MMV0002-MANDT .
ZC103MMT0002-BPID =
ZC103MMV0002-BPID .
ZC103MMT0002-NAME =
ZC103MMV0002-NAME .
ZC103MMT0002-TELLNUM =
ZC103MMV0002-TELLNUM .
ZC103MMT0002-ADDRESS =
ZC103MMV0002-ADDRESS .
ZC103MMT0002-ACCOUNT =
ZC103MMV0002-ACCOUNT .
ZC103MMT0002-CURRENCY =
ZC103MMV0002-CURRENCY .
ZC103MMT0002-PTERM =
ZC103MMV0002-PTERM .
ZC103MMT0002-ERDAT =
ZC103MMV0002-ERDAT .
ZC103MMT0002-ERZET =
ZC103MMV0002-ERZET .
ZC103MMT0002-ERNAM =
ZC103MMV0002-ERNAM .
ZC103MMT0002-AEDAT =
ZC103MMV0002-AEDAT .
ZC103MMT0002-AEZET =
ZC103MMV0002-AEZET .
ZC103MMT0002-AENAM =
ZC103MMV0002-AENAM .
    IF SY-SUBRC = 0.
    UPDATE ZC103MMT0002 ##WARN_OK.
    ELSE.
    INSERT ZC103MMT0002 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_ZC103MMV0002-UPD_FLAG,
STATUS_ZC103MMV0002-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_ZC103MMV0002.
  SELECT SINGLE * FROM ZC103MMT0002 WHERE
BPID = ZC103MMV0002-BPID .
ZC103MMV0002-MANDT =
ZC103MMT0002-MANDT .
ZC103MMV0002-BPID =
ZC103MMT0002-BPID .
ZC103MMV0002-NAME =
ZC103MMT0002-NAME .
ZC103MMV0002-TELLNUM =
ZC103MMT0002-TELLNUM .
ZC103MMV0002-ADDRESS =
ZC103MMT0002-ADDRESS .
ZC103MMV0002-ACCOUNT =
ZC103MMT0002-ACCOUNT .
ZC103MMV0002-CURRENCY =
ZC103MMT0002-CURRENCY .
ZC103MMV0002-PTERM =
ZC103MMT0002-PTERM .
ZC103MMV0002-ERDAT =
ZC103MMT0002-ERDAT .
ZC103MMV0002-ERZET =
ZC103MMT0002-ERZET .
ZC103MMV0002-ERNAM =
ZC103MMT0002-ERNAM .
ZC103MMV0002-AEDAT =
ZC103MMT0002-AEDAT .
ZC103MMV0002-AEZET =
ZC103MMT0002-AEZET .
ZC103MMV0002-AENAM =
ZC103MMT0002-AENAM .
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_ZC103MMV0002 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE ZC103MMV0002-BPID TO
ZC103MMT0002-BPID .
MOVE ZC103MMV0002-MANDT TO
ZC103MMT0002-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = 'ZC103MMT0002'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN ZC103MMT0002 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING 'ZC103MMT0002'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
*...processing: ZC103MMV0003....................................*
FORM GET_DATA_ZC103MMV0003.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM ZC103MMT0003 WHERE
(VIM_WHERETAB) .
    CLEAR ZC103MMV0003 .
ZC103MMV0003-MANDT =
ZC103MMT0003-MANDT .
ZC103MMV0003-PLNID =
ZC103MMT0003-PLNID .
ZC103MMV0003-NAME =
ZC103MMT0003-NAME .
ZC103MMV0003-ADDRESS =
ZC103MMT0003-ADDRESS .
ZC103MMV0003-PTYPE =
ZC103MMT0003-PTYPE .
ZC103MMV0003-ERDAT =
ZC103MMT0003-ERDAT .
ZC103MMV0003-ERZET =
ZC103MMT0003-ERZET .
ZC103MMV0003-ERNAM =
ZC103MMT0003-ERNAM .
ZC103MMV0003-AEDAT =
ZC103MMT0003-AEDAT .
ZC103MMV0003-AEZET =
ZC103MMT0003-AEZET .
ZC103MMV0003-AENAM =
ZC103MMT0003-AENAM .
<VIM_TOTAL_STRUC> = ZC103MMV0003.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_ZC103MMV0003 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO ZC103MMV0003.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_ZC103MMV0003-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM ZC103MMT0003 WHERE
  PLNID = ZC103MMV0003-PLNID .
    IF SY-SUBRC = 0.
    DELETE ZC103MMT0003 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM ZC103MMT0003 WHERE
  PLNID = ZC103MMV0003-PLNID .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR ZC103MMT0003.
    ENDIF.
ZC103MMT0003-MANDT =
ZC103MMV0003-MANDT .
ZC103MMT0003-PLNID =
ZC103MMV0003-PLNID .
ZC103MMT0003-NAME =
ZC103MMV0003-NAME .
ZC103MMT0003-ADDRESS =
ZC103MMV0003-ADDRESS .
ZC103MMT0003-PTYPE =
ZC103MMV0003-PTYPE .
ZC103MMT0003-ERDAT =
ZC103MMV0003-ERDAT .
ZC103MMT0003-ERZET =
ZC103MMV0003-ERZET .
ZC103MMT0003-ERNAM =
ZC103MMV0003-ERNAM .
ZC103MMT0003-AEDAT =
ZC103MMV0003-AEDAT .
ZC103MMT0003-AEZET =
ZC103MMV0003-AEZET .
ZC103MMT0003-AENAM =
ZC103MMV0003-AENAM .
    IF SY-SUBRC = 0.
    UPDATE ZC103MMT0003 ##WARN_OK.
    ELSE.
    INSERT ZC103MMT0003 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_ZC103MMV0003-UPD_FLAG,
STATUS_ZC103MMV0003-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_ZC103MMV0003.
  SELECT SINGLE * FROM ZC103MMT0003 WHERE
PLNID = ZC103MMV0003-PLNID .
ZC103MMV0003-MANDT =
ZC103MMT0003-MANDT .
ZC103MMV0003-PLNID =
ZC103MMT0003-PLNID .
ZC103MMV0003-NAME =
ZC103MMT0003-NAME .
ZC103MMV0003-ADDRESS =
ZC103MMT0003-ADDRESS .
ZC103MMV0003-PTYPE =
ZC103MMT0003-PTYPE .
ZC103MMV0003-ERDAT =
ZC103MMT0003-ERDAT .
ZC103MMV0003-ERZET =
ZC103MMT0003-ERZET .
ZC103MMV0003-ERNAM =
ZC103MMT0003-ERNAM .
ZC103MMV0003-AEDAT =
ZC103MMT0003-AEDAT .
ZC103MMV0003-AEZET =
ZC103MMT0003-AEZET .
ZC103MMV0003-AENAM =
ZC103MMT0003-AENAM .
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_ZC103MMV0003 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE ZC103MMV0003-PLNID TO
ZC103MMT0003-PLNID .
MOVE ZC103MMV0003-MANDT TO
ZC103MMT0003-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = 'ZC103MMT0003'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN ZC103MMT0003 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING 'ZC103MMT0003'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
*...processing: ZC103MMV0004....................................*
FORM GET_DATA_ZC103MMV0004.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM ZC103MMT0004 WHERE
(VIM_WHERETAB) .
    CLEAR ZC103MMV0004 .
ZC103MMV0004-MANDT =
ZC103MMT0004-MANDT .
ZC103MMV0004-STRID =
ZC103MMT0004-STRID .
ZC103MMV0004-PLNID =
ZC103MMT0004-PLNID .
ZC103MMV0004-NAME =
ZC103MMT0004-NAME .
ZC103MMV0004-STYPE =
ZC103MMT0004-STYPE .
ZC103MMV0004-ERDAT =
ZC103MMT0004-ERDAT .
ZC103MMV0004-ERZET =
ZC103MMT0004-ERZET .
ZC103MMV0004-ERNAM =
ZC103MMT0004-ERNAM .
ZC103MMV0004-AEDAT =
ZC103MMT0004-AEDAT .
ZC103MMV0004-AEZET =
ZC103MMT0004-AEZET .
ZC103MMV0004-AENAM =
ZC103MMT0004-AENAM .
<VIM_TOTAL_STRUC> = ZC103MMV0004.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_ZC103MMV0004 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO ZC103MMV0004.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_ZC103MMV0004-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM ZC103MMT0004 WHERE
  STRID = ZC103MMV0004-STRID .
    IF SY-SUBRC = 0.
    DELETE ZC103MMT0004 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM ZC103MMT0004 WHERE
  STRID = ZC103MMV0004-STRID .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR ZC103MMT0004.
    ENDIF.
ZC103MMT0004-MANDT =
ZC103MMV0004-MANDT .
ZC103MMT0004-STRID =
ZC103MMV0004-STRID .
ZC103MMT0004-PLNID =
ZC103MMV0004-PLNID .
ZC103MMT0004-NAME =
ZC103MMV0004-NAME .
ZC103MMT0004-STYPE =
ZC103MMV0004-STYPE .
ZC103MMT0004-ERDAT =
ZC103MMV0004-ERDAT .
ZC103MMT0004-ERZET =
ZC103MMV0004-ERZET .
ZC103MMT0004-ERNAM =
ZC103MMV0004-ERNAM .
ZC103MMT0004-AEDAT =
ZC103MMV0004-AEDAT .
ZC103MMT0004-AEZET =
ZC103MMV0004-AEZET .
ZC103MMT0004-AENAM =
ZC103MMV0004-AENAM .
    IF SY-SUBRC = 0.
    UPDATE ZC103MMT0004 ##WARN_OK.
    ELSE.
    INSERT ZC103MMT0004 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_ZC103MMV0004-UPD_FLAG,
STATUS_ZC103MMV0004-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_ZC103MMV0004.
  SELECT SINGLE * FROM ZC103MMT0004 WHERE
STRID = ZC103MMV0004-STRID .
ZC103MMV0004-MANDT =
ZC103MMT0004-MANDT .
ZC103MMV0004-STRID =
ZC103MMT0004-STRID .
ZC103MMV0004-PLNID =
ZC103MMT0004-PLNID .
ZC103MMV0004-NAME =
ZC103MMT0004-NAME .
ZC103MMV0004-STYPE =
ZC103MMT0004-STYPE .
ZC103MMV0004-ERDAT =
ZC103MMT0004-ERDAT .
ZC103MMV0004-ERZET =
ZC103MMT0004-ERZET .
ZC103MMV0004-ERNAM =
ZC103MMT0004-ERNAM .
ZC103MMV0004-AEDAT =
ZC103MMT0004-AEDAT .
ZC103MMV0004-AEZET =
ZC103MMT0004-AEZET .
ZC103MMV0004-AENAM =
ZC103MMT0004-AENAM .
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_ZC103MMV0004 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE ZC103MMV0004-STRID TO
ZC103MMT0004-STRID .
MOVE ZC103MMV0004-MANDT TO
ZC103MMT0004-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = 'ZC103MMT0004'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN ZC103MMT0004 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING 'ZC103MMT0004'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
*...processing: ZC103MMV0005....................................*
FORM GET_DATA_ZC103MMV0005.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM ZC103MMT0005 WHERE
(VIM_WHERETAB) .
    CLEAR ZC103MMV0005 .
ZC103MMV0005-MANDT =
ZC103MMT0005-MANDT .
ZC103MMV0005-PIRID =
ZC103MMT0005-PIRID .
ZC103MMV0005-MATID =
ZC103MMT0005-MATID .
ZC103MMV0005-BPID =
ZC103MMT0005-BPID .
ZC103MMV0005-LIFAB =
ZC103MMT0005-LIFAB .
ZC103MMV0005-LIFBI =
ZC103MMT0005-LIFBI .
ZC103MMV0005-LEADTIME =
ZC103MMT0005-LEADTIME .
ZC103MMV0005-PRICE =
ZC103MMT0005-PRICE .
ZC103MMV0005-CURRENCY =
ZC103MMT0005-CURRENCY .
ZC103MMV0005-ERDAT =
ZC103MMT0005-ERDAT .
ZC103MMV0005-ERZET =
ZC103MMT0005-ERZET .
ZC103MMV0005-ERNAM =
ZC103MMT0005-ERNAM .
ZC103MMV0005-AEDAT =
ZC103MMT0005-AEDAT .
ZC103MMV0005-AEZET =
ZC103MMT0005-AEZET .
ZC103MMV0005-AENAM =
ZC103MMT0005-AENAM .
<VIM_TOTAL_STRUC> = ZC103MMV0005.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_ZC103MMV0005 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO ZC103MMV0005.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_ZC103MMV0005-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM ZC103MMT0005 WHERE
  PIRID = ZC103MMV0005-PIRID .
    IF SY-SUBRC = 0.
    DELETE ZC103MMT0005 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM ZC103MMT0005 WHERE
  PIRID = ZC103MMV0005-PIRID .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR ZC103MMT0005.
    ENDIF.
ZC103MMT0005-MANDT =
ZC103MMV0005-MANDT .
ZC103MMT0005-PIRID =
ZC103MMV0005-PIRID .
ZC103MMT0005-MATID =
ZC103MMV0005-MATID .
ZC103MMT0005-BPID =
ZC103MMV0005-BPID .
ZC103MMT0005-LIFAB =
ZC103MMV0005-LIFAB .
ZC103MMT0005-LIFBI =
ZC103MMV0005-LIFBI .
ZC103MMT0005-LEADTIME =
ZC103MMV0005-LEADTIME .
ZC103MMT0005-PRICE =
ZC103MMV0005-PRICE .
ZC103MMT0005-CURRENCY =
ZC103MMV0005-CURRENCY .
ZC103MMT0005-ERDAT =
ZC103MMV0005-ERDAT .
ZC103MMT0005-ERZET =
ZC103MMV0005-ERZET .
ZC103MMT0005-ERNAM =
ZC103MMV0005-ERNAM .
ZC103MMT0005-AEDAT =
ZC103MMV0005-AEDAT .
ZC103MMT0005-AEZET =
ZC103MMV0005-AEZET .
ZC103MMT0005-AENAM =
ZC103MMV0005-AENAM .
    IF SY-SUBRC = 0.
    UPDATE ZC103MMT0005 ##WARN_OK.
    ELSE.
    INSERT ZC103MMT0005 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_ZC103MMV0005-UPD_FLAG,
STATUS_ZC103MMV0005-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_ZC103MMV0005.
  SELECT SINGLE * FROM ZC103MMT0005 WHERE
PIRID = ZC103MMV0005-PIRID .
ZC103MMV0005-MANDT =
ZC103MMT0005-MANDT .
ZC103MMV0005-PIRID =
ZC103MMT0005-PIRID .
ZC103MMV0005-MATID =
ZC103MMT0005-MATID .
ZC103MMV0005-BPID =
ZC103MMT0005-BPID .
ZC103MMV0005-LIFAB =
ZC103MMT0005-LIFAB .
ZC103MMV0005-LIFBI =
ZC103MMT0005-LIFBI .
ZC103MMV0005-LEADTIME =
ZC103MMT0005-LEADTIME .
ZC103MMV0005-PRICE =
ZC103MMT0005-PRICE .
ZC103MMV0005-CURRENCY =
ZC103MMT0005-CURRENCY .
ZC103MMV0005-ERDAT =
ZC103MMT0005-ERDAT .
ZC103MMV0005-ERZET =
ZC103MMT0005-ERZET .
ZC103MMV0005-ERNAM =
ZC103MMT0005-ERNAM .
ZC103MMV0005-AEDAT =
ZC103MMT0005-AEDAT .
ZC103MMV0005-AEZET =
ZC103MMT0005-AEZET .
ZC103MMV0005-AENAM =
ZC103MMT0005-AENAM .
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_ZC103MMV0005 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE ZC103MMV0005-PIRID TO
ZC103MMT0005-PIRID .
MOVE ZC103MMV0005-MANDT TO
ZC103MMT0005-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = 'ZC103MMT0005'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN ZC103MMT0005 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING 'ZC103MMT0005'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
*...processing: ZC103MMV0006....................................*
FORM GET_DATA_ZC103MMV0006.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM ZC103MMT0006 WHERE
(VIM_WHERETAB) .
    CLEAR ZC103MMV0006 .
ZC103MMV0006-MANDT =
ZC103MMT0006-MANDT .
ZC103MMV0006-STOID =
ZC103MMT0006-STOID .
ZC103MMV0006-MATID =
ZC103MMT0006-MATID .
ZC103MMV0006-PLNID =
ZC103MMT0006-PLNID .
ZC103MMV0006-STRID =
ZC103MMT0006-STRID .
ZC103MMV0006-AVAILABLE_STOCK =
ZC103MMT0006-AVAILABLE_STOCK .
ZC103MMV0006-FLIGHT_STOCK =
ZC103MMT0006-FLIGHT_STOCK .
ZC103MMV0006-RESERVED_STOCK =
ZC103MMT0006-RESERVED_STOCK .
ZC103MMV0006-STOCK_IN_TRANSFER =
ZC103MMT0006-STOCK_IN_TRANSFER .
ZC103MMV0006-UNIT =
ZC103MMT0006-UNIT .
ZC103MMV0006-ERDAT =
ZC103MMT0006-ERDAT .
ZC103MMV0006-ERZET =
ZC103MMT0006-ERZET .
ZC103MMV0006-ERNAM =
ZC103MMT0006-ERNAM .
ZC103MMV0006-AEDAT =
ZC103MMT0006-AEDAT .
ZC103MMV0006-AEZET =
ZC103MMT0006-AEZET .
ZC103MMV0006-AENAM =
ZC103MMT0006-AENAM .
<VIM_TOTAL_STRUC> = ZC103MMV0006.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_ZC103MMV0006 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO ZC103MMV0006.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_ZC103MMV0006-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM ZC103MMT0006 WHERE
  STOID = ZC103MMV0006-STOID .
    IF SY-SUBRC = 0.
    DELETE ZC103MMT0006 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM ZC103MMT0006 WHERE
  STOID = ZC103MMV0006-STOID .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR ZC103MMT0006.
    ENDIF.
ZC103MMT0006-MANDT =
ZC103MMV0006-MANDT .
ZC103MMT0006-STOID =
ZC103MMV0006-STOID .
ZC103MMT0006-MATID =
ZC103MMV0006-MATID .
ZC103MMT0006-PLNID =
ZC103MMV0006-PLNID .
ZC103MMT0006-STRID =
ZC103MMV0006-STRID .
ZC103MMT0006-AVAILABLE_STOCK =
ZC103MMV0006-AVAILABLE_STOCK .
ZC103MMT0006-FLIGHT_STOCK =
ZC103MMV0006-FLIGHT_STOCK .
ZC103MMT0006-RESERVED_STOCK =
ZC103MMV0006-RESERVED_STOCK .
ZC103MMT0006-STOCK_IN_TRANSFER =
ZC103MMV0006-STOCK_IN_TRANSFER .
ZC103MMT0006-UNIT =
ZC103MMV0006-UNIT .
ZC103MMT0006-ERDAT =
ZC103MMV0006-ERDAT .
ZC103MMT0006-ERZET =
ZC103MMV0006-ERZET .
ZC103MMT0006-ERNAM =
ZC103MMV0006-ERNAM .
ZC103MMT0006-AEDAT =
ZC103MMV0006-AEDAT .
ZC103MMT0006-AEZET =
ZC103MMV0006-AEZET .
ZC103MMT0006-AENAM =
ZC103MMV0006-AENAM .
    IF SY-SUBRC = 0.
    UPDATE ZC103MMT0006 ##WARN_OK.
    ELSE.
    INSERT ZC103MMT0006 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_ZC103MMV0006-UPD_FLAG,
STATUS_ZC103MMV0006-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_ZC103MMV0006.
  SELECT SINGLE * FROM ZC103MMT0006 WHERE
STOID = ZC103MMV0006-STOID .
ZC103MMV0006-MANDT =
ZC103MMT0006-MANDT .
ZC103MMV0006-STOID =
ZC103MMT0006-STOID .
ZC103MMV0006-MATID =
ZC103MMT0006-MATID .
ZC103MMV0006-PLNID =
ZC103MMT0006-PLNID .
ZC103MMV0006-STRID =
ZC103MMT0006-STRID .
ZC103MMV0006-AVAILABLE_STOCK =
ZC103MMT0006-AVAILABLE_STOCK .
ZC103MMV0006-FLIGHT_STOCK =
ZC103MMT0006-FLIGHT_STOCK .
ZC103MMV0006-RESERVED_STOCK =
ZC103MMT0006-RESERVED_STOCK .
ZC103MMV0006-STOCK_IN_TRANSFER =
ZC103MMT0006-STOCK_IN_TRANSFER .
ZC103MMV0006-UNIT =
ZC103MMT0006-UNIT .
ZC103MMV0006-ERDAT =
ZC103MMT0006-ERDAT .
ZC103MMV0006-ERZET =
ZC103MMT0006-ERZET .
ZC103MMV0006-ERNAM =
ZC103MMT0006-ERNAM .
ZC103MMV0006-AEDAT =
ZC103MMT0006-AEDAT .
ZC103MMV0006-AEZET =
ZC103MMT0006-AEZET .
ZC103MMV0006-AENAM =
ZC103MMT0006-AENAM .
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_ZC103MMV0006 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE ZC103MMV0006-STOID TO
ZC103MMT0006-STOID .
MOVE ZC103MMV0006-MANDT TO
ZC103MMT0006-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = 'ZC103MMT0006'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN ZC103MMT0006 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING 'ZC103MMT0006'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
*...processing: ZC103MMV0019....................................*
FORM GET_DATA_ZC103MMV0019.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM ZC103MMT0019 WHERE
(VIM_WHERETAB) .
    CLEAR ZC103MMV0019 .
ZC103MMV0019-MANDT =
ZC103MMT0019-MANDT .
ZC103MMV0019-BPID =
ZC103MMT0019-BPID .
ZC103MMV0019-PRICE_SCORE =
ZC103MMT0019-PRICE_SCORE .
ZC103MMV0019-QUALITY_SCORE =
ZC103MMT0019-QUALITY_SCORE .
ZC103MMV0019-RECEIVE_SCORE =
ZC103MMT0019-RECEIVE_SCORE .
ZC103MMV0019-ERDAT =
ZC103MMT0019-ERDAT .
ZC103MMV0019-ERZET =
ZC103MMT0019-ERZET .
ZC103MMV0019-ERNAM =
ZC103MMT0019-ERNAM .
ZC103MMV0019-AEDAT =
ZC103MMT0019-AEDAT .
ZC103MMV0019-AEZET =
ZC103MMT0019-AEZET .
ZC103MMV0019-AENAM =
ZC103MMT0019-AENAM .
<VIM_TOTAL_STRUC> = ZC103MMV0019.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_ZC103MMV0019 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO ZC103MMV0019.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_ZC103MMV0019-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM ZC103MMT0019 WHERE
  BPID = ZC103MMV0019-BPID .
    IF SY-SUBRC = 0.
    DELETE ZC103MMT0019 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM ZC103MMT0019 WHERE
  BPID = ZC103MMV0019-BPID .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR ZC103MMT0019.
    ENDIF.
ZC103MMT0019-MANDT =
ZC103MMV0019-MANDT .
ZC103MMT0019-BPID =
ZC103MMV0019-BPID .
ZC103MMT0019-PRICE_SCORE =
ZC103MMV0019-PRICE_SCORE .
ZC103MMT0019-QUALITY_SCORE =
ZC103MMV0019-QUALITY_SCORE .
ZC103MMT0019-RECEIVE_SCORE =
ZC103MMV0019-RECEIVE_SCORE .
ZC103MMT0019-ERDAT =
ZC103MMV0019-ERDAT .
ZC103MMT0019-ERZET =
ZC103MMV0019-ERZET .
ZC103MMT0019-ERNAM =
ZC103MMV0019-ERNAM .
ZC103MMT0019-AEDAT =
ZC103MMV0019-AEDAT .
ZC103MMT0019-AEZET =
ZC103MMV0019-AEZET .
ZC103MMT0019-AENAM =
ZC103MMV0019-AENAM .
    IF SY-SUBRC = 0.
    UPDATE ZC103MMT0019 ##WARN_OK.
    ELSE.
    INSERT ZC103MMT0019 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_ZC103MMV0019-UPD_FLAG,
STATUS_ZC103MMV0019-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_ZC103MMV0019.
  SELECT SINGLE * FROM ZC103MMT0019 WHERE
BPID = ZC103MMV0019-BPID .
ZC103MMV0019-MANDT =
ZC103MMT0019-MANDT .
ZC103MMV0019-BPID =
ZC103MMT0019-BPID .
ZC103MMV0019-PRICE_SCORE =
ZC103MMT0019-PRICE_SCORE .
ZC103MMV0019-QUALITY_SCORE =
ZC103MMT0019-QUALITY_SCORE .
ZC103MMV0019-RECEIVE_SCORE =
ZC103MMT0019-RECEIVE_SCORE .
ZC103MMV0019-ERDAT =
ZC103MMT0019-ERDAT .
ZC103MMV0019-ERZET =
ZC103MMT0019-ERZET .
ZC103MMV0019-ERNAM =
ZC103MMT0019-ERNAM .
ZC103MMV0019-AEDAT =
ZC103MMT0019-AEDAT .
ZC103MMV0019-AEZET =
ZC103MMT0019-AEZET .
ZC103MMV0019-AENAM =
ZC103MMT0019-AENAM .
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_ZC103MMV0019 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE ZC103MMV0019-BPID TO
ZC103MMT0019-BPID .
MOVE ZC103MMV0019-MANDT TO
ZC103MMT0019-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = 'ZC103MMT0019'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN ZC103MMT0019 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING 'ZC103MMT0019'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
*...processing: ZC103PMV0001....................................*
FORM GET_DATA_ZC103PMV0001.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM ZC103PMT0001 WHERE
(VIM_WHERETAB) .
    CLEAR ZC103PMV0001 .
ZC103PMV0001-MANDT =
ZC103PMT0001-MANDT .
ZC103PMV0001-AIRCRAFT_ID =
ZC103PMT0001-AIRCRAFT_ID .
ZC103PMV0001-AIRCRAFT_TYPE =
ZC103PMT0001-AIRCRAFT_TYPE .
ZC103PMV0001-IN_SERVICE_DATE =
ZC103PMT0001-IN_SERVICE_DATE .
ZC103PMV0001-STATUS =
ZC103PMT0001-STATUS .
ZC103PMV0001-REMARKS =
ZC103PMT0001-REMARKS .
ZC103PMV0001-ERDAT =
ZC103PMT0001-ERDAT .
ZC103PMV0001-ERZET =
ZC103PMT0001-ERZET .
ZC103PMV0001-ERNAM =
ZC103PMT0001-ERNAM .
ZC103PMV0001-AEDAT =
ZC103PMT0001-AEDAT .
ZC103PMV0001-AEZET =
ZC103PMT0001-AEZET .
ZC103PMV0001-AENAM =
ZC103PMT0001-AENAM .
<VIM_TOTAL_STRUC> = ZC103PMV0001.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_ZC103PMV0001 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO ZC103PMV0001.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_ZC103PMV0001-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM ZC103PMT0001 WHERE
  AIRCRAFT_ID = ZC103PMV0001-AIRCRAFT_ID .
    IF SY-SUBRC = 0.
    DELETE ZC103PMT0001 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM ZC103PMT0001 WHERE
  AIRCRAFT_ID = ZC103PMV0001-AIRCRAFT_ID .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR ZC103PMT0001.
    ENDIF.
ZC103PMT0001-MANDT =
ZC103PMV0001-MANDT .
ZC103PMT0001-AIRCRAFT_ID =
ZC103PMV0001-AIRCRAFT_ID .
ZC103PMT0001-AIRCRAFT_TYPE =
ZC103PMV0001-AIRCRAFT_TYPE .
ZC103PMT0001-IN_SERVICE_DATE =
ZC103PMV0001-IN_SERVICE_DATE .
ZC103PMT0001-STATUS =
ZC103PMV0001-STATUS .
ZC103PMT0001-REMARKS =
ZC103PMV0001-REMARKS .
ZC103PMT0001-ERDAT =
ZC103PMV0001-ERDAT .
ZC103PMT0001-ERZET =
ZC103PMV0001-ERZET .
ZC103PMT0001-ERNAM =
ZC103PMV0001-ERNAM .
ZC103PMT0001-AEDAT =
ZC103PMV0001-AEDAT .
ZC103PMT0001-AEZET =
ZC103PMV0001-AEZET .
ZC103PMT0001-AENAM =
ZC103PMV0001-AENAM .
    IF SY-SUBRC = 0.
    UPDATE ZC103PMT0001 ##WARN_OK.
    ELSE.
    INSERT ZC103PMT0001 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_ZC103PMV0001-UPD_FLAG,
STATUS_ZC103PMV0001-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_ZC103PMV0001.
  SELECT SINGLE * FROM ZC103PMT0001 WHERE
AIRCRAFT_ID = ZC103PMV0001-AIRCRAFT_ID .
ZC103PMV0001-MANDT =
ZC103PMT0001-MANDT .
ZC103PMV0001-AIRCRAFT_ID =
ZC103PMT0001-AIRCRAFT_ID .
ZC103PMV0001-AIRCRAFT_TYPE =
ZC103PMT0001-AIRCRAFT_TYPE .
ZC103PMV0001-IN_SERVICE_DATE =
ZC103PMT0001-IN_SERVICE_DATE .
ZC103PMV0001-STATUS =
ZC103PMT0001-STATUS .
ZC103PMV0001-REMARKS =
ZC103PMT0001-REMARKS .
ZC103PMV0001-ERDAT =
ZC103PMT0001-ERDAT .
ZC103PMV0001-ERZET =
ZC103PMT0001-ERZET .
ZC103PMV0001-ERNAM =
ZC103PMT0001-ERNAM .
ZC103PMV0001-AEDAT =
ZC103PMT0001-AEDAT .
ZC103PMV0001-AEZET =
ZC103PMT0001-AEZET .
ZC103PMV0001-AENAM =
ZC103PMT0001-AENAM .
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_ZC103PMV0001 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE ZC103PMV0001-AIRCRAFT_ID TO
ZC103PMT0001-AIRCRAFT_ID .
MOVE ZC103PMV0001-MANDT TO
ZC103PMT0001-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = 'ZC103PMT0001'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN ZC103PMT0001 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING 'ZC103PMT0001'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
*...processing: ZC103PMV0003....................................*
FORM GET_DATA_ZC103PMV0003.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM ZC103PMT0003 WHERE
(VIM_WHERETAB) .
    CLEAR ZC103PMV0003 .
ZC103PMV0003-MANDT =
ZC103PMT0003-MANDT .
ZC103PMV0003-MAINT_TYPE =
ZC103PMT0003-MAINT_TYPE .
ZC103PMV0003-AIRCRAFT_TYPE =
ZC103PMT0003-AIRCRAFT_TYPE .
ZC103PMV0003-FH_CYCLE =
ZC103PMT0003-FH_CYCLE .
ZC103PMV0003-EXEC_HOURS =
ZC103PMT0003-EXEC_HOURS .
ZC103PMV0003-REMARKS =
ZC103PMT0003-REMARKS .
ZC103PMV0003-ERDAT =
ZC103PMT0003-ERDAT .
ZC103PMV0003-ERZET =
ZC103PMT0003-ERZET .
ZC103PMV0003-ERNAM =
ZC103PMT0003-ERNAM .
ZC103PMV0003-AEDAT =
ZC103PMT0003-AEDAT .
ZC103PMV0003-AEZET =
ZC103PMT0003-AEZET .
ZC103PMV0003-AENAM =
ZC103PMT0003-AENAM .
<VIM_TOTAL_STRUC> = ZC103PMV0003.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_ZC103PMV0003 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO ZC103PMV0003.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_ZC103PMV0003-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM ZC103PMT0003 WHERE
  MAINT_TYPE = ZC103PMV0003-MAINT_TYPE AND
  AIRCRAFT_TYPE = ZC103PMV0003-AIRCRAFT_TYPE .
    IF SY-SUBRC = 0.
    DELETE ZC103PMT0003 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM ZC103PMT0003 WHERE
  MAINT_TYPE = ZC103PMV0003-MAINT_TYPE AND
  AIRCRAFT_TYPE = ZC103PMV0003-AIRCRAFT_TYPE .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR ZC103PMT0003.
    ENDIF.
ZC103PMT0003-MANDT =
ZC103PMV0003-MANDT .
ZC103PMT0003-MAINT_TYPE =
ZC103PMV0003-MAINT_TYPE .
ZC103PMT0003-AIRCRAFT_TYPE =
ZC103PMV0003-AIRCRAFT_TYPE .
ZC103PMT0003-FH_CYCLE =
ZC103PMV0003-FH_CYCLE .
ZC103PMT0003-EXEC_HOURS =
ZC103PMV0003-EXEC_HOURS .
ZC103PMT0003-REMARKS =
ZC103PMV0003-REMARKS .
ZC103PMT0003-ERDAT =
ZC103PMV0003-ERDAT .
ZC103PMT0003-ERZET =
ZC103PMV0003-ERZET .
ZC103PMT0003-ERNAM =
ZC103PMV0003-ERNAM .
ZC103PMT0003-AEDAT =
ZC103PMV0003-AEDAT .
ZC103PMT0003-AEZET =
ZC103PMV0003-AEZET .
ZC103PMT0003-AENAM =
ZC103PMV0003-AENAM .
    IF SY-SUBRC = 0.
    UPDATE ZC103PMT0003 ##WARN_OK.
    ELSE.
    INSERT ZC103PMT0003 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_ZC103PMV0003-UPD_FLAG,
STATUS_ZC103PMV0003-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_ZC103PMV0003.
  SELECT SINGLE * FROM ZC103PMT0003 WHERE
MAINT_TYPE = ZC103PMV0003-MAINT_TYPE AND
AIRCRAFT_TYPE = ZC103PMV0003-AIRCRAFT_TYPE .
ZC103PMV0003-MANDT =
ZC103PMT0003-MANDT .
ZC103PMV0003-MAINT_TYPE =
ZC103PMT0003-MAINT_TYPE .
ZC103PMV0003-AIRCRAFT_TYPE =
ZC103PMT0003-AIRCRAFT_TYPE .
ZC103PMV0003-FH_CYCLE =
ZC103PMT0003-FH_CYCLE .
ZC103PMV0003-EXEC_HOURS =
ZC103PMT0003-EXEC_HOURS .
ZC103PMV0003-REMARKS =
ZC103PMT0003-REMARKS .
ZC103PMV0003-ERDAT =
ZC103PMT0003-ERDAT .
ZC103PMV0003-ERZET =
ZC103PMT0003-ERZET .
ZC103PMV0003-ERNAM =
ZC103PMT0003-ERNAM .
ZC103PMV0003-AEDAT =
ZC103PMT0003-AEDAT .
ZC103PMV0003-AEZET =
ZC103PMT0003-AEZET .
ZC103PMV0003-AENAM =
ZC103PMT0003-AENAM .
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_ZC103PMV0003 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE ZC103PMV0003-MAINT_TYPE TO
ZC103PMT0003-MAINT_TYPE .
MOVE ZC103PMV0003-AIRCRAFT_TYPE TO
ZC103PMT0003-AIRCRAFT_TYPE .
MOVE ZC103PMV0003-MANDT TO
ZC103PMT0003-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = 'ZC103PMT0003'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN ZC103PMT0003 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING 'ZC103PMT0003'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
*...processing: ZC103PMV0006....................................*
FORM GET_DATA_ZC103PMV0006.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM ZC103PMT0006 WHERE
(VIM_WHERETAB) .
    CLEAR ZC103PMV0006 .
ZC103PMV0006-MANDT =
ZC103PMT0006-MANDT .
ZC103PMV0006-TECH_ID =
ZC103PMT0006-TECH_ID .
ZC103PMV0006-NAME =
ZC103PMT0006-NAME .
ZC103PMV0006-SKILL_TYPE =
ZC103PMT0006-SKILL_TYPE .
ZC103PMV0006-ACTIVE =
ZC103PMT0006-ACTIVE .
ZC103PMV0006-REMARKS =
ZC103PMT0006-REMARKS .
ZC103PMV0006-ERDAT =
ZC103PMT0006-ERDAT .
ZC103PMV0006-ERZET =
ZC103PMT0006-ERZET .
ZC103PMV0006-ERNAM =
ZC103PMT0006-ERNAM .
ZC103PMV0006-AEDAT =
ZC103PMT0006-AEDAT .
ZC103PMV0006-AEZET =
ZC103PMT0006-AEZET .
ZC103PMV0006-AENAM =
ZC103PMT0006-AENAM .
<VIM_TOTAL_STRUC> = ZC103PMV0006.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_ZC103PMV0006 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO ZC103PMV0006.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_ZC103PMV0006-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM ZC103PMT0006 WHERE
  TECH_ID = ZC103PMV0006-TECH_ID .
    IF SY-SUBRC = 0.
    DELETE ZC103PMT0006 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM ZC103PMT0006 WHERE
  TECH_ID = ZC103PMV0006-TECH_ID .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR ZC103PMT0006.
    ENDIF.
ZC103PMT0006-MANDT =
ZC103PMV0006-MANDT .
ZC103PMT0006-TECH_ID =
ZC103PMV0006-TECH_ID .
ZC103PMT0006-NAME =
ZC103PMV0006-NAME .
ZC103PMT0006-SKILL_TYPE =
ZC103PMV0006-SKILL_TYPE .
ZC103PMT0006-ACTIVE =
ZC103PMV0006-ACTIVE .
ZC103PMT0006-REMARKS =
ZC103PMV0006-REMARKS .
ZC103PMT0006-ERDAT =
ZC103PMV0006-ERDAT .
ZC103PMT0006-ERZET =
ZC103PMV0006-ERZET .
ZC103PMT0006-ERNAM =
ZC103PMV0006-ERNAM .
ZC103PMT0006-AEDAT =
ZC103PMV0006-AEDAT .
ZC103PMT0006-AEZET =
ZC103PMV0006-AEZET .
ZC103PMT0006-AENAM =
ZC103PMV0006-AENAM .
    IF SY-SUBRC = 0.
    UPDATE ZC103PMT0006 ##WARN_OK.
    ELSE.
    INSERT ZC103PMT0006 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_ZC103PMV0006-UPD_FLAG,
STATUS_ZC103PMV0006-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_ZC103PMV0006.
  SELECT SINGLE * FROM ZC103PMT0006 WHERE
TECH_ID = ZC103PMV0006-TECH_ID .
ZC103PMV0006-MANDT =
ZC103PMT0006-MANDT .
ZC103PMV0006-TECH_ID =
ZC103PMT0006-TECH_ID .
ZC103PMV0006-NAME =
ZC103PMT0006-NAME .
ZC103PMV0006-SKILL_TYPE =
ZC103PMT0006-SKILL_TYPE .
ZC103PMV0006-ACTIVE =
ZC103PMT0006-ACTIVE .
ZC103PMV0006-REMARKS =
ZC103PMT0006-REMARKS .
ZC103PMV0006-ERDAT =
ZC103PMT0006-ERDAT .
ZC103PMV0006-ERZET =
ZC103PMT0006-ERZET .
ZC103PMV0006-ERNAM =
ZC103PMT0006-ERNAM .
ZC103PMV0006-AEDAT =
ZC103PMT0006-AEDAT .
ZC103PMV0006-AEZET =
ZC103PMT0006-AEZET .
ZC103PMV0006-AENAM =
ZC103PMT0006-AENAM .
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_ZC103PMV0006 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE ZC103PMV0006-TECH_ID TO
ZC103PMT0006-TECH_ID .
MOVE ZC103PMV0006-MANDT TO
ZC103PMT0006-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = 'ZC103PMT0006'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN ZC103PMT0006 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING 'ZC103PMT0006'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
*...processing: ZC103PMV0007....................................*
FORM GET_DATA_ZC103PMV0007.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM ZC103PMT0007 WHERE
(VIM_WHERETAB) .
    CLEAR ZC103PMV0007 .
ZC103PMV0007-MANDT =
ZC103PMT0007-MANDT .
ZC103PMV0007-TECH_ID =
ZC103PMT0007-TECH_ID .
ZC103PMV0007-WORK_DATE =
ZC103PMT0007-WORK_DATE .
ZC103PMV0007-SHIFT_CODE =
ZC103PMT0007-SHIFT_CODE .
ZC103PMV0007-SHIFT_TIME_FROM =
ZC103PMT0007-SHIFT_TIME_FROM .
ZC103PMV0007-SHIFT_TIME_TO =
ZC103PMT0007-SHIFT_TIME_TO .
ZC103PMV0007-WORK_STATUS =
ZC103PMT0007-WORK_STATUS .
ZC103PMV0007-REMARKS =
ZC103PMT0007-REMARKS .
ZC103PMV0007-ERDAT =
ZC103PMT0007-ERDAT .
ZC103PMV0007-ERZET =
ZC103PMT0007-ERZET .
ZC103PMV0007-ERNAM =
ZC103PMT0007-ERNAM .
ZC103PMV0007-AEDAT =
ZC103PMT0007-AEDAT .
ZC103PMV0007-AEZET =
ZC103PMT0007-AEZET .
ZC103PMV0007-AENAM =
ZC103PMT0007-AENAM .
<VIM_TOTAL_STRUC> = ZC103PMV0007.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_ZC103PMV0007 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO ZC103PMV0007.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_ZC103PMV0007-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM ZC103PMT0007 WHERE
  TECH_ID = ZC103PMV0007-TECH_ID AND
  WORK_DATE = ZC103PMV0007-WORK_DATE .
    IF SY-SUBRC = 0.
    DELETE ZC103PMT0007 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM ZC103PMT0007 WHERE
  TECH_ID = ZC103PMV0007-TECH_ID AND
  WORK_DATE = ZC103PMV0007-WORK_DATE .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR ZC103PMT0007.
    ENDIF.
ZC103PMT0007-MANDT =
ZC103PMV0007-MANDT .
ZC103PMT0007-TECH_ID =
ZC103PMV0007-TECH_ID .
ZC103PMT0007-WORK_DATE =
ZC103PMV0007-WORK_DATE .
ZC103PMT0007-SHIFT_CODE =
ZC103PMV0007-SHIFT_CODE .
ZC103PMT0007-SHIFT_TIME_FROM =
ZC103PMV0007-SHIFT_TIME_FROM .
ZC103PMT0007-SHIFT_TIME_TO =
ZC103PMV0007-SHIFT_TIME_TO .
ZC103PMT0007-WORK_STATUS =
ZC103PMV0007-WORK_STATUS .
ZC103PMT0007-REMARKS =
ZC103PMV0007-REMARKS .
ZC103PMT0007-ERDAT =
ZC103PMV0007-ERDAT .
ZC103PMT0007-ERZET =
ZC103PMV0007-ERZET .
ZC103PMT0007-ERNAM =
ZC103PMV0007-ERNAM .
ZC103PMT0007-AEDAT =
ZC103PMV0007-AEDAT .
ZC103PMT0007-AEZET =
ZC103PMV0007-AEZET .
ZC103PMT0007-AENAM =
ZC103PMV0007-AENAM .
    IF SY-SUBRC = 0.
    UPDATE ZC103PMT0007 ##WARN_OK.
    ELSE.
    INSERT ZC103PMT0007 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_ZC103PMV0007-UPD_FLAG,
STATUS_ZC103PMV0007-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_ZC103PMV0007.
  SELECT SINGLE * FROM ZC103PMT0007 WHERE
TECH_ID = ZC103PMV0007-TECH_ID AND
WORK_DATE = ZC103PMV0007-WORK_DATE .
ZC103PMV0007-MANDT =
ZC103PMT0007-MANDT .
ZC103PMV0007-TECH_ID =
ZC103PMT0007-TECH_ID .
ZC103PMV0007-WORK_DATE =
ZC103PMT0007-WORK_DATE .
ZC103PMV0007-SHIFT_CODE =
ZC103PMT0007-SHIFT_CODE .
ZC103PMV0007-SHIFT_TIME_FROM =
ZC103PMT0007-SHIFT_TIME_FROM .
ZC103PMV0007-SHIFT_TIME_TO =
ZC103PMT0007-SHIFT_TIME_TO .
ZC103PMV0007-WORK_STATUS =
ZC103PMT0007-WORK_STATUS .
ZC103PMV0007-REMARKS =
ZC103PMT0007-REMARKS .
ZC103PMV0007-ERDAT =
ZC103PMT0007-ERDAT .
ZC103PMV0007-ERZET =
ZC103PMT0007-ERZET .
ZC103PMV0007-ERNAM =
ZC103PMT0007-ERNAM .
ZC103PMV0007-AEDAT =
ZC103PMT0007-AEDAT .
ZC103PMV0007-AEZET =
ZC103PMT0007-AEZET .
ZC103PMV0007-AENAM =
ZC103PMT0007-AENAM .
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_ZC103PMV0007 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE ZC103PMV0007-TECH_ID TO
ZC103PMT0007-TECH_ID .
MOVE ZC103PMV0007-WORK_DATE TO
ZC103PMT0007-WORK_DATE .
MOVE ZC103PMV0007-MANDT TO
ZC103PMT0007-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = 'ZC103PMT0007'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN ZC103PMT0007 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING 'ZC103PMT0007'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
*...processing: ZC103PMV0010....................................*
FORM GET_DATA_ZC103PMV0010.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM ZC103PMT0010 WHERE
(VIM_WHERETAB) .
    CLEAR ZC103PMV0010 .
ZC103PMV0010-MANDT =
ZC103PMT0010-MANDT .
ZC103PMV0010-MAINT_TYPE =
ZC103PMT0010-MAINT_TYPE .
ZC103PMV0010-AIRCRAFT_TYPE =
ZC103PMT0010-AIRCRAFT_TYPE .
ZC103PMV0010-MATERIAL_ID =
ZC103PMT0010-MATERIAL_ID .
ZC103PMV0010-QTY_PLANNED =
ZC103PMT0010-QTY_PLANNED .
ZC103PMV0010-UOM =
ZC103PMT0010-UOM .
ZC103PMV0010-IS_SERIAL =
ZC103PMT0010-IS_SERIAL .
ZC103PMV0010-REMARKS =
ZC103PMT0010-REMARKS .
ZC103PMV0010-ERDAT =
ZC103PMT0010-ERDAT .
ZC103PMV0010-ERZET =
ZC103PMT0010-ERZET .
ZC103PMV0010-ERNAM =
ZC103PMT0010-ERNAM .
ZC103PMV0010-AEDAT =
ZC103PMT0010-AEDAT .
ZC103PMV0010-AEZET =
ZC103PMT0010-AEZET .
ZC103PMV0010-AENAM =
ZC103PMT0010-AENAM .
<VIM_TOTAL_STRUC> = ZC103PMV0010.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_ZC103PMV0010 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO ZC103PMV0010.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_ZC103PMV0010-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM ZC103PMT0010 WHERE
  MAINT_TYPE = ZC103PMV0010-MAINT_TYPE AND
  AIRCRAFT_TYPE = ZC103PMV0010-AIRCRAFT_TYPE AND
  MATERIAL_ID = ZC103PMV0010-MATERIAL_ID .
    IF SY-SUBRC = 0.
    DELETE ZC103PMT0010 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM ZC103PMT0010 WHERE
  MAINT_TYPE = ZC103PMV0010-MAINT_TYPE AND
  AIRCRAFT_TYPE = ZC103PMV0010-AIRCRAFT_TYPE AND
  MATERIAL_ID = ZC103PMV0010-MATERIAL_ID .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR ZC103PMT0010.
    ENDIF.
ZC103PMT0010-MANDT =
ZC103PMV0010-MANDT .
ZC103PMT0010-MAINT_TYPE =
ZC103PMV0010-MAINT_TYPE .
ZC103PMT0010-AIRCRAFT_TYPE =
ZC103PMV0010-AIRCRAFT_TYPE .
ZC103PMT0010-MATERIAL_ID =
ZC103PMV0010-MATERIAL_ID .
ZC103PMT0010-QTY_PLANNED =
ZC103PMV0010-QTY_PLANNED .
ZC103PMT0010-UOM =
ZC103PMV0010-UOM .
ZC103PMT0010-IS_SERIAL =
ZC103PMV0010-IS_SERIAL .
ZC103PMT0010-REMARKS =
ZC103PMV0010-REMARKS .
ZC103PMT0010-ERDAT =
ZC103PMV0010-ERDAT .
ZC103PMT0010-ERZET =
ZC103PMV0010-ERZET .
ZC103PMT0010-ERNAM =
ZC103PMV0010-ERNAM .
ZC103PMT0010-AEDAT =
ZC103PMV0010-AEDAT .
ZC103PMT0010-AEZET =
ZC103PMV0010-AEZET .
ZC103PMT0010-AENAM =
ZC103PMV0010-AENAM .
    IF SY-SUBRC = 0.
    UPDATE ZC103PMT0010 ##WARN_OK.
    ELSE.
    INSERT ZC103PMT0010 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_ZC103PMV0010-UPD_FLAG,
STATUS_ZC103PMV0010-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_ZC103PMV0010.
  SELECT SINGLE * FROM ZC103PMT0010 WHERE
MAINT_TYPE = ZC103PMV0010-MAINT_TYPE AND
AIRCRAFT_TYPE = ZC103PMV0010-AIRCRAFT_TYPE AND
MATERIAL_ID = ZC103PMV0010-MATERIAL_ID .
ZC103PMV0010-MANDT =
ZC103PMT0010-MANDT .
ZC103PMV0010-MAINT_TYPE =
ZC103PMT0010-MAINT_TYPE .
ZC103PMV0010-AIRCRAFT_TYPE =
ZC103PMT0010-AIRCRAFT_TYPE .
ZC103PMV0010-MATERIAL_ID =
ZC103PMT0010-MATERIAL_ID .
ZC103PMV0010-QTY_PLANNED =
ZC103PMT0010-QTY_PLANNED .
ZC103PMV0010-UOM =
ZC103PMT0010-UOM .
ZC103PMV0010-IS_SERIAL =
ZC103PMT0010-IS_SERIAL .
ZC103PMV0010-REMARKS =
ZC103PMT0010-REMARKS .
ZC103PMV0010-ERDAT =
ZC103PMT0010-ERDAT .
ZC103PMV0010-ERZET =
ZC103PMT0010-ERZET .
ZC103PMV0010-ERNAM =
ZC103PMT0010-ERNAM .
ZC103PMV0010-AEDAT =
ZC103PMT0010-AEDAT .
ZC103PMV0010-AEZET =
ZC103PMT0010-AEZET .
ZC103PMV0010-AENAM =
ZC103PMT0010-AENAM .
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_ZC103PMV0010 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE ZC103PMV0010-MAINT_TYPE TO
ZC103PMT0010-MAINT_TYPE .
MOVE ZC103PMV0010-AIRCRAFT_TYPE TO
ZC103PMT0010-AIRCRAFT_TYPE .
MOVE ZC103PMV0010-MATERIAL_ID TO
ZC103PMT0010-MATERIAL_ID .
MOVE ZC103PMV0010-MANDT TO
ZC103PMT0010-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = 'ZC103PMT0010'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN ZC103PMT0010 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING 'ZC103PMT0010'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
*...processing: ZC103PMV0011....................................*
FORM GET_DATA_ZC103PMV0011.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM ZC103PMT0011 WHERE
(VIM_WHERETAB) .
    CLEAR ZC103PMV0011 .
ZC103PMV0011-MANDT =
ZC103PMT0011-MANDT .
ZC103PMV0011-ORDER_ID =
ZC103PMT0011-ORDER_ID .
ZC103PMV0011-MATERIAL_ID =
ZC103PMT0011-MATERIAL_ID .
ZC103PMV0011-QUANTITY_USED =
ZC103PMT0011-QUANTITY_USED .
ZC103PMV0011-UOM =
ZC103PMT0011-UOM .
ZC103PMV0011-IS_SERIAL =
ZC103PMT0011-IS_SERIAL .
ZC103PMV0011-REMARKS =
ZC103PMT0011-REMARKS .
ZC103PMV0011-ERDAT =
ZC103PMT0011-ERDAT .
ZC103PMV0011-ERZET =
ZC103PMT0011-ERZET .
ZC103PMV0011-ERNAM =
ZC103PMT0011-ERNAM .
ZC103PMV0011-AEDAT =
ZC103PMT0011-AEDAT .
ZC103PMV0011-AEZET =
ZC103PMT0011-AEZET .
ZC103PMV0011-AENAM =
ZC103PMT0011-AENAM .
<VIM_TOTAL_STRUC> = ZC103PMV0011.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_ZC103PMV0011 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO ZC103PMV0011.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_ZC103PMV0011-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM ZC103PMT0011 WHERE
  ORDER_ID = ZC103PMV0011-ORDER_ID AND
  MATERIAL_ID = ZC103PMV0011-MATERIAL_ID .
    IF SY-SUBRC = 0.
    DELETE ZC103PMT0011 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM ZC103PMT0011 WHERE
  ORDER_ID = ZC103PMV0011-ORDER_ID AND
  MATERIAL_ID = ZC103PMV0011-MATERIAL_ID .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR ZC103PMT0011.
    ENDIF.
ZC103PMT0011-MANDT =
ZC103PMV0011-MANDT .
ZC103PMT0011-ORDER_ID =
ZC103PMV0011-ORDER_ID .
ZC103PMT0011-MATERIAL_ID =
ZC103PMV0011-MATERIAL_ID .
ZC103PMT0011-QUANTITY_USED =
ZC103PMV0011-QUANTITY_USED .
ZC103PMT0011-UOM =
ZC103PMV0011-UOM .
ZC103PMT0011-IS_SERIAL =
ZC103PMV0011-IS_SERIAL .
ZC103PMT0011-REMARKS =
ZC103PMV0011-REMARKS .
ZC103PMT0011-ERDAT =
ZC103PMV0011-ERDAT .
ZC103PMT0011-ERZET =
ZC103PMV0011-ERZET .
ZC103PMT0011-ERNAM =
ZC103PMV0011-ERNAM .
ZC103PMT0011-AEDAT =
ZC103PMV0011-AEDAT .
ZC103PMT0011-AEZET =
ZC103PMV0011-AEZET .
ZC103PMT0011-AENAM =
ZC103PMV0011-AENAM .
    IF SY-SUBRC = 0.
    UPDATE ZC103PMT0011 ##WARN_OK.
    ELSE.
    INSERT ZC103PMT0011 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_ZC103PMV0011-UPD_FLAG,
STATUS_ZC103PMV0011-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_ZC103PMV0011.
  SELECT SINGLE * FROM ZC103PMT0011 WHERE
ORDER_ID = ZC103PMV0011-ORDER_ID AND
MATERIAL_ID = ZC103PMV0011-MATERIAL_ID .
ZC103PMV0011-MANDT =
ZC103PMT0011-MANDT .
ZC103PMV0011-ORDER_ID =
ZC103PMT0011-ORDER_ID .
ZC103PMV0011-MATERIAL_ID =
ZC103PMT0011-MATERIAL_ID .
ZC103PMV0011-QUANTITY_USED =
ZC103PMT0011-QUANTITY_USED .
ZC103PMV0011-UOM =
ZC103PMT0011-UOM .
ZC103PMV0011-IS_SERIAL =
ZC103PMT0011-IS_SERIAL .
ZC103PMV0011-REMARKS =
ZC103PMT0011-REMARKS .
ZC103PMV0011-ERDAT =
ZC103PMT0011-ERDAT .
ZC103PMV0011-ERZET =
ZC103PMT0011-ERZET .
ZC103PMV0011-ERNAM =
ZC103PMT0011-ERNAM .
ZC103PMV0011-AEDAT =
ZC103PMT0011-AEDAT .
ZC103PMV0011-AEZET =
ZC103PMT0011-AEZET .
ZC103PMV0011-AENAM =
ZC103PMT0011-AENAM .
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_ZC103PMV0011 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE ZC103PMV0011-ORDER_ID TO
ZC103PMT0011-ORDER_ID .
MOVE ZC103PMV0011-MATERIAL_ID TO
ZC103PMT0011-MATERIAL_ID .
MOVE ZC103PMV0011-MANDT TO
ZC103PMT0011-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = 'ZC103PMT0011'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN ZC103PMT0011 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING 'ZC103PMT0011'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
*...processing: ZC103PMV0015....................................*
FORM GET_DATA_ZC103PMV0015.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM ZC103PMT0015 WHERE
(VIM_WHERETAB) .
    CLEAR ZC103PMV0015 .
ZC103PMV0015-AIRCRAFT_ID =
ZC103PMT0015-AIRCRAFT_ID .
ZC103PMV0015-FH_TOTAL =
ZC103PMT0015-FH_TOTAL .
ZC103PMV0015-FH_SINCE_LAST_A =
ZC103PMT0015-FH_SINCE_LAST_A .
ZC103PMV0015-FH_SINCE_LAST_C =
ZC103PMT0015-FH_SINCE_LAST_C .
ZC103PMV0015-FH_SINCE_LAST_D =
ZC103PMT0015-FH_SINCE_LAST_D .
ZC103PMV0015-REMARKS =
ZC103PMT0015-REMARKS .
ZC103PMV0015-ERDAT =
ZC103PMT0015-ERDAT .
ZC103PMV0015-ERZET =
ZC103PMT0015-ERZET .
ZC103PMV0015-ERNAM =
ZC103PMT0015-ERNAM .
ZC103PMV0015-AEDAT =
ZC103PMT0015-AEDAT .
ZC103PMV0015-AEZET =
ZC103PMT0015-AEZET .
ZC103PMV0015-AENAM =
ZC103PMT0015-AENAM .
<VIM_TOTAL_STRUC> = ZC103PMV0015.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_ZC103PMV0015 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO ZC103PMV0015.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_ZC103PMV0015-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM ZC103PMT0015 WHERE
  AIRCRAFT_ID = ZC103PMV0015-AIRCRAFT_ID .
    IF SY-SUBRC = 0.
    DELETE ZC103PMT0015 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM ZC103PMT0015 WHERE
  AIRCRAFT_ID = ZC103PMV0015-AIRCRAFT_ID .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR ZC103PMT0015.
    ENDIF.
ZC103PMT0015-AIRCRAFT_ID =
ZC103PMV0015-AIRCRAFT_ID .
ZC103PMT0015-FH_TOTAL =
ZC103PMV0015-FH_TOTAL .
ZC103PMT0015-FH_SINCE_LAST_A =
ZC103PMV0015-FH_SINCE_LAST_A .
ZC103PMT0015-FH_SINCE_LAST_C =
ZC103PMV0015-FH_SINCE_LAST_C .
ZC103PMT0015-FH_SINCE_LAST_D =
ZC103PMV0015-FH_SINCE_LAST_D .
ZC103PMT0015-REMARKS =
ZC103PMV0015-REMARKS .
ZC103PMT0015-ERDAT =
ZC103PMV0015-ERDAT .
ZC103PMT0015-ERZET =
ZC103PMV0015-ERZET .
ZC103PMT0015-ERNAM =
ZC103PMV0015-ERNAM .
ZC103PMT0015-AEDAT =
ZC103PMV0015-AEDAT .
ZC103PMT0015-AEZET =
ZC103PMV0015-AEZET .
ZC103PMT0015-AENAM =
ZC103PMV0015-AENAM .
    IF SY-SUBRC = 0.
    UPDATE ZC103PMT0015 ##WARN_OK.
    ELSE.
    INSERT ZC103PMT0015 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_ZC103PMV0015-UPD_FLAG,
STATUS_ZC103PMV0015-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_ZC103PMV0015.
  SELECT SINGLE * FROM ZC103PMT0015 WHERE
AIRCRAFT_ID = ZC103PMV0015-AIRCRAFT_ID .
ZC103PMV0015-AIRCRAFT_ID =
ZC103PMT0015-AIRCRAFT_ID .
ZC103PMV0015-FH_TOTAL =
ZC103PMT0015-FH_TOTAL .
ZC103PMV0015-FH_SINCE_LAST_A =
ZC103PMT0015-FH_SINCE_LAST_A .
ZC103PMV0015-FH_SINCE_LAST_C =
ZC103PMT0015-FH_SINCE_LAST_C .
ZC103PMV0015-FH_SINCE_LAST_D =
ZC103PMT0015-FH_SINCE_LAST_D .
ZC103PMV0015-REMARKS =
ZC103PMT0015-REMARKS .
ZC103PMV0015-ERDAT =
ZC103PMT0015-ERDAT .
ZC103PMV0015-ERZET =
ZC103PMT0015-ERZET .
ZC103PMV0015-ERNAM =
ZC103PMT0015-ERNAM .
ZC103PMV0015-AEDAT =
ZC103PMT0015-AEDAT .
ZC103PMV0015-AEZET =
ZC103PMT0015-AEZET .
ZC103PMV0015-AENAM =
ZC103PMT0015-AENAM .
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_ZC103PMV0015 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE ZC103PMV0015-AIRCRAFT_ID TO
ZC103PMT0015-AIRCRAFT_ID .
MOVE SY-MANDT TO
ZC103PMT0015-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = 'ZC103PMT0015'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN ZC103PMT0015 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING 'ZC103PMT0015'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
*...processing: ZC103PPV0007....................................*
FORM GET_DATA_ZC103PPV0007.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM ZC103PPT0007 WHERE
(VIM_WHERETAB) .
    CLEAR ZC103PPV0007 .
ZC103PPV0007-MANDT =
ZC103PPT0007-MANDT .
ZC103PPV0007-PPLAN_ID =
ZC103PPT0007-PPLAN_ID .
ZC103PPV0007-PLAN_YEAR =
ZC103PPT0007-PLAN_YEAR .
ZC103PPV0007-PLAN_MONTH =
ZC103PPT0007-PLAN_MONTH .
ZC103PPV0007-SPLAN_ID =
ZC103PPT0007-SPLAN_ID .
ZC103PPV0007-REQ_DATE =
ZC103PPT0007-REQ_DATE .
ZC103PPV0007-DESCRIPTION =
ZC103PPT0007-DESCRIPTION .
ZC103PPV0007-STATUS =
ZC103PPT0007-STATUS .
ZC103PPV0007-EMPNO =
ZC103PPT0007-EMPNO .
ZC103PPV0007-ERDAT =
ZC103PPT0007-ERDAT .
ZC103PPV0007-ERZET =
ZC103PPT0007-ERZET .
ZC103PPV0007-ERNAM =
ZC103PPT0007-ERNAM .
ZC103PPV0007-AEDAT =
ZC103PPT0007-AEDAT .
ZC103PPV0007-AEZET =
ZC103PPT0007-AEZET .
ZC103PPV0007-AENAM =
ZC103PPT0007-AENAM .
<VIM_TOTAL_STRUC> = ZC103PPV0007.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_ZC103PPV0007 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO ZC103PPV0007.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_ZC103PPV0007-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM ZC103PPT0007 WHERE
  PPLAN_ID = ZC103PPV0007-PPLAN_ID .
    IF SY-SUBRC = 0.
    DELETE ZC103PPT0007 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM ZC103PPT0007 WHERE
  PPLAN_ID = ZC103PPV0007-PPLAN_ID .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR ZC103PPT0007.
    ENDIF.
ZC103PPT0007-MANDT =
ZC103PPV0007-MANDT .
ZC103PPT0007-PPLAN_ID =
ZC103PPV0007-PPLAN_ID .
ZC103PPT0007-PLAN_YEAR =
ZC103PPV0007-PLAN_YEAR .
ZC103PPT0007-PLAN_MONTH =
ZC103PPV0007-PLAN_MONTH .
ZC103PPT0007-SPLAN_ID =
ZC103PPV0007-SPLAN_ID .
ZC103PPT0007-REQ_DATE =
ZC103PPV0007-REQ_DATE .
ZC103PPT0007-DESCRIPTION =
ZC103PPV0007-DESCRIPTION .
ZC103PPT0007-STATUS =
ZC103PPV0007-STATUS .
ZC103PPT0007-EMPNO =
ZC103PPV0007-EMPNO .
ZC103PPT0007-ERDAT =
ZC103PPV0007-ERDAT .
ZC103PPT0007-ERZET =
ZC103PPV0007-ERZET .
ZC103PPT0007-ERNAM =
ZC103PPV0007-ERNAM .
ZC103PPT0007-AEDAT =
ZC103PPV0007-AEDAT .
ZC103PPT0007-AEZET =
ZC103PPV0007-AEZET .
ZC103PPT0007-AENAM =
ZC103PPV0007-AENAM .
    IF SY-SUBRC = 0.
    UPDATE ZC103PPT0007 ##WARN_OK.
    ELSE.
    INSERT ZC103PPT0007 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_ZC103PPV0007-UPD_FLAG,
STATUS_ZC103PPV0007-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_ZC103PPV0007.
  SELECT SINGLE * FROM ZC103PPT0007 WHERE
PPLAN_ID = ZC103PPV0007-PPLAN_ID .
ZC103PPV0007-MANDT =
ZC103PPT0007-MANDT .
ZC103PPV0007-PPLAN_ID =
ZC103PPT0007-PPLAN_ID .
ZC103PPV0007-PLAN_YEAR =
ZC103PPT0007-PLAN_YEAR .
ZC103PPV0007-PLAN_MONTH =
ZC103PPT0007-PLAN_MONTH .
ZC103PPV0007-SPLAN_ID =
ZC103PPT0007-SPLAN_ID .
ZC103PPV0007-REQ_DATE =
ZC103PPT0007-REQ_DATE .
ZC103PPV0007-DESCRIPTION =
ZC103PPT0007-DESCRIPTION .
ZC103PPV0007-STATUS =
ZC103PPT0007-STATUS .
ZC103PPV0007-EMPNO =
ZC103PPT0007-EMPNO .
ZC103PPV0007-ERDAT =
ZC103PPT0007-ERDAT .
ZC103PPV0007-ERZET =
ZC103PPT0007-ERZET .
ZC103PPV0007-ERNAM =
ZC103PPT0007-ERNAM .
ZC103PPV0007-AEDAT =
ZC103PPT0007-AEDAT .
ZC103PPV0007-AEZET =
ZC103PPT0007-AEZET .
ZC103PPV0007-AENAM =
ZC103PPT0007-AENAM .
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_ZC103PPV0007 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE ZC103PPV0007-PPLAN_ID TO
ZC103PPT0007-PPLAN_ID .
MOVE ZC103PPV0007-MANDT TO
ZC103PPT0007-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = 'ZC103PPT0007'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN ZC103PPT0007 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING 'ZC103PPT0007'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*
*...processing: ZC103PPV0008....................................*
FORM GET_DATA_ZC103PPV0008.
  PERFORM VIM_FILL_WHERETAB.
*.read data from database.............................................*
  REFRESH TOTAL.
  CLEAR   TOTAL.
  SELECT * FROM ZC103PPT0008 WHERE
(VIM_WHERETAB) .
    CLEAR ZC103PPV0008 .
ZC103PPV0008-MANDT =
ZC103PPT0008-MANDT .
ZC103PPV0008-PPLAN_ID =
ZC103PPT0008-PPLAN_ID .
ZC103PPV0008-MAT_ID =
ZC103PPT0008-MAT_ID .
ZC103PPV0008-MAT_NAME =
ZC103PPT0008-MAT_NAME .
ZC103PPV0008-QUANTITY =
ZC103PPT0008-QUANTITY .
ZC103PPV0008-UNIT =
ZC103PPT0008-UNIT .
ZC103PPV0008-PLANT_ID =
ZC103PPT0008-PLANT_ID .
ZC103PPV0008-PLANT_NAME =
ZC103PPT0008-PLANT_NAME .
ZC103PPV0008-ERDAT =
ZC103PPT0008-ERDAT .
ZC103PPV0008-ERZET =
ZC103PPT0008-ERZET .
ZC103PPV0008-ERNAM =
ZC103PPT0008-ERNAM .
ZC103PPV0008-AEDAT =
ZC103PPT0008-AEDAT .
ZC103PPV0008-AEZET =
ZC103PPT0008-AEZET .
ZC103PPV0008-AENAM =
ZC103PPT0008-AENAM .
<VIM_TOTAL_STRUC> = ZC103PPV0008.
    APPEND TOTAL.
  ENDSELECT.
  SORT TOTAL BY <VIM_XTOTAL_KEY>.
  <STATUS>-ALR_SORTED = 'R'.
*.check dynamic selectoptions (not in DDIC)...........................*
  IF X_HEADER-SELECTION NE SPACE.
    PERFORM CHECK_DYNAMIC_SELECT_OPTIONS.
  ELSEIF X_HEADER-DELMDTFLAG NE SPACE.
    PERFORM BUILD_MAINKEY_TAB.
  ENDIF.
  REFRESH EXTRACT.
ENDFORM.
*---------------------------------------------------------------------*
FORM DB_UPD_ZC103PPV0008 .
*.process data base updates/inserts/deletes.........................*
LOOP AT TOTAL.
  CHECK <ACTION> NE ORIGINAL.
MOVE <VIM_TOTAL_STRUC> TO ZC103PPV0008.
  IF <ACTION> = UPDATE_GELOESCHT.
    <ACTION> = GELOESCHT.
  ENDIF.
  CASE <ACTION>.
   WHEN NEUER_GELOESCHT.
IF STATUS_ZC103PPV0008-ST_DELETE EQ GELOESCHT.
     READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
     IF SY-SUBRC EQ 0.
       DELETE EXTRACT INDEX SY-TABIX.
     ENDIF.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN GELOESCHT.
  SELECT SINGLE FOR UPDATE * FROM ZC103PPT0008 WHERE
  PPLAN_ID = ZC103PPV0008-PPLAN_ID AND
  MAT_ID = ZC103PPV0008-MAT_ID .
    IF SY-SUBRC = 0.
    DELETE ZC103PPT0008 .
    ENDIF.
    IF STATUS-DELETE EQ GELOESCHT.
      READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY> BINARY SEARCH.
      DELETE EXTRACT INDEX SY-TABIX.
    ENDIF.
    DELETE TOTAL.
    IF X_HEADER-DELMDTFLAG NE SPACE.
      PERFORM DELETE_FROM_MAINKEY_TAB.
    ENDIF.
   WHEN OTHERS.
  SELECT SINGLE FOR UPDATE * FROM ZC103PPT0008 WHERE
  PPLAN_ID = ZC103PPV0008-PPLAN_ID AND
  MAT_ID = ZC103PPV0008-MAT_ID .
    IF SY-SUBRC <> 0.   "insert preprocessing: init WA
      CLEAR ZC103PPT0008.
    ENDIF.
ZC103PPT0008-MANDT =
ZC103PPV0008-MANDT .
ZC103PPT0008-PPLAN_ID =
ZC103PPV0008-PPLAN_ID .
ZC103PPT0008-MAT_ID =
ZC103PPV0008-MAT_ID .
ZC103PPT0008-MAT_NAME =
ZC103PPV0008-MAT_NAME .
ZC103PPT0008-QUANTITY =
ZC103PPV0008-QUANTITY .
ZC103PPT0008-UNIT =
ZC103PPV0008-UNIT .
ZC103PPT0008-PLANT_ID =
ZC103PPV0008-PLANT_ID .
ZC103PPT0008-PLANT_NAME =
ZC103PPV0008-PLANT_NAME .
ZC103PPT0008-ERDAT =
ZC103PPV0008-ERDAT .
ZC103PPT0008-ERZET =
ZC103PPV0008-ERZET .
ZC103PPT0008-ERNAM =
ZC103PPV0008-ERNAM .
ZC103PPT0008-AEDAT =
ZC103PPV0008-AEDAT .
ZC103PPT0008-AEZET =
ZC103PPV0008-AEZET .
ZC103PPT0008-AENAM =
ZC103PPV0008-AENAM .
    IF SY-SUBRC = 0.
    UPDATE ZC103PPT0008 ##WARN_OK.
    ELSE.
    INSERT ZC103PPT0008 .
    ENDIF.
    READ TABLE EXTRACT WITH KEY <VIM_XTOTAL_KEY>.
    IF SY-SUBRC EQ 0.
      <XACT> = ORIGINAL.
      MODIFY EXTRACT INDEX SY-TABIX.
    ENDIF.
    <ACTION> = ORIGINAL.
    MODIFY TOTAL.
  ENDCASE.
ENDLOOP.
CLEAR: STATUS_ZC103PPV0008-UPD_FLAG,
STATUS_ZC103PPV0008-UPD_CHECKD.
MESSAGE S018(SV).
ENDFORM.
*---------------------------------------------------------------------*
FORM READ_SINGLE_ZC103PPV0008.
  SELECT SINGLE * FROM ZC103PPT0008 WHERE
PPLAN_ID = ZC103PPV0008-PPLAN_ID AND
MAT_ID = ZC103PPV0008-MAT_ID .
ZC103PPV0008-MANDT =
ZC103PPT0008-MANDT .
ZC103PPV0008-PPLAN_ID =
ZC103PPT0008-PPLAN_ID .
ZC103PPV0008-MAT_ID =
ZC103PPT0008-MAT_ID .
ZC103PPV0008-MAT_NAME =
ZC103PPT0008-MAT_NAME .
ZC103PPV0008-QUANTITY =
ZC103PPT0008-QUANTITY .
ZC103PPV0008-UNIT =
ZC103PPT0008-UNIT .
ZC103PPV0008-PLANT_ID =
ZC103PPT0008-PLANT_ID .
ZC103PPV0008-PLANT_NAME =
ZC103PPT0008-PLANT_NAME .
ZC103PPV0008-ERDAT =
ZC103PPT0008-ERDAT .
ZC103PPV0008-ERZET =
ZC103PPT0008-ERZET .
ZC103PPV0008-ERNAM =
ZC103PPT0008-ERNAM .
ZC103PPV0008-AEDAT =
ZC103PPT0008-AEDAT .
ZC103PPV0008-AEZET =
ZC103PPT0008-AEZET .
ZC103PPV0008-AENAM =
ZC103PPT0008-AENAM .
ENDFORM.
*---------------------------------------------------------------------*
FORM CORR_MAINT_ZC103PPV0008 USING VALUE(CM_ACTION) RC.
  DATA: RETCODE LIKE SY-SUBRC, COUNT TYPE I, TRSP_KEYLEN TYPE SYFLENG.
  FIELD-SYMBOLS: <TAB_KEY_X> TYPE X.
  CLEAR RC.
MOVE ZC103PPV0008-PPLAN_ID TO
ZC103PPT0008-PPLAN_ID .
MOVE ZC103PPV0008-MAT_ID TO
ZC103PPT0008-MAT_ID .
MOVE ZC103PPV0008-MANDT TO
ZC103PPT0008-MANDT .
  CORR_KEYTAB             =  E071K.
  CORR_KEYTAB-OBJNAME     = 'ZC103PPT0008'.
  IF NOT <vim_corr_keyx> IS ASSIGNED.
    ASSIGN CORR_KEYTAB-TABKEY TO <vim_corr_keyx> CASTING.
  ENDIF.
  ASSIGN ZC103PPT0008 TO <TAB_KEY_X> CASTING.
  PERFORM VIM_GET_TRSPKEYLEN
    USING 'ZC103PPT0008'
    CHANGING TRSP_KEYLEN.
  <VIM_CORR_KEYX>(TRSP_KEYLEN) = <TAB_KEY_X>(TRSP_KEYLEN).
  PERFORM UPDATE_CORR_KEYTAB USING CM_ACTION RETCODE.
  ADD: RETCODE TO RC, 1 TO COUNT.
  IF RC LT COUNT AND CM_ACTION NE PRUEFEN.
    CLEAR RC.
  ENDIF.

ENDFORM.
*---------------------------------------------------------------------*

* base table related FORM-routines.............
INCLUDE LSVIMFTX .

----------------------------------------------------------------------------------
Extracted by Direct Download Enterprise version 1.3.1 - E.G.Mellodew. 1998-2005 UK. Sap Release 758
```
